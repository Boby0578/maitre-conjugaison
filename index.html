<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maître de la Conjugaison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 800px;
            width: 90%;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .menu {
            display: none;
            text-align: center;
        }

        .menu.active {
            display: block;
        }

        .level-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 4px 15px 0 rgba(31, 38, 135, 0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px 0 rgba(31, 38, 135, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-level {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-level:hover {
            background: linear-gradient(45deg, #00f2fe 0%, #4facfe 100%);
        }

        .btn-start {
            background: linear-gradient(45deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            font-size: 1.3em;
            padding: 20px 40px;
        }

        .btn-start:hover {
            background: linear-gradient(45deg, #38f9d7 0%, #43e97b 100%);
        }

        .game-area {
            display: none;
            text-align: center;
        }

        .game-area.active {
            display: block;
        }

        .question {
            font-size: 1.5em;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            line-height: 1.6;
        }

        .verb { color: #f093fb; }
        .tense { color: #4facfe; }
        .pronoun { color: #43e97b; }

        .microphone-container {
            margin: 30px 0;
        }

        .microphone {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(245, 87, 108, 0.4);
        }

        .microphone:hover {
            transform: scale(1.1);
        }

        .microphone.recording {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 87, 108, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(245, 87, 108, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 87, 108, 0); }
        }

        .microphone svg {
            width: 40px;
            height: 40px;
            fill: white;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            margin: 20px 0;
            text-align: center;
        }

        .score {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .message {
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success {
            background: linear-gradient(45deg, #43e97b 0%, #38f9d7 100%);
        }

        .error {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
        }

        .buttons-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.9em;
        }

        .btn-reveal {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
        }

        .btn-conjugation {
            background: linear-gradient(45deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        .conjugation-table {
            display: none;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .conjugation-table.active {
            display: block;
        }

        .conjugation-table h3 {
            color: #4facfe;
            margin-bottom: 15px;
        }

        .conjugation-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .conjugation-table th,
        .conjugation-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .conjugation-table th {
            background: #f093fb;
            color: white;
        }

        .player-name-input {
            padding: 10px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            margin: 10px;
        }

        .timer-selection {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .timer-display {
            font-size: 2em;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .leaderboard h3 {
            margin-bottom: 15px;
            color: #f093fb;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Maître de la Conjugaison</h1>
        
        <!-- Menu Principal -->
        <div id="mainMenu" class="menu active">
            <div class="level-selection">
                <button class="btn btn-level" onclick="selectLevel(1)">Niveau 1</button>
                <button class="btn btn-level" onclick="selectLevel(2)">Niveau 2</button>
                <button class="btn btn-level" onclick="selectLevel(3)">Niveau 3</button>
            </div>
            
            <div class="timer-selection">
                <button class="btn btn-small" onclick="selectTimer(0)">Sans limite</button>
                <button class="btn btn-small" onclick="selectTimer(15)">15 min</button>
                <button class="btn btn-small" onclick="selectTimer(10)">10 min</button>
                <button class="btn btn-small" onclick="selectTimer(5)">5 min</button>
            </div>
            
            <div>
                <input type="text" id="playerName" class="player-name-input" placeholder="Entrez votre nom">
            </div>
            
            <button class="btn btn-start" onclick="startGame()">Commencer</button>
            
            <div id="leaderboard" class="leaderboard">
                <h3>Meilleurs Scores</h3>
                <div id="leaderboardEntries"></div>
            </div>
        </div>
        
        <!-- Zone de Jeu -->
        <div id="gameArea" class="game-area">
            <div class="timer-display" id="timerDisplay"></div>
            
            <div class="score">
                Score: <span id="scoreValue">0</span> points
            </div>
            
            <div id="question" class="question"></div>
            
            <div class="microphone-container">
                <button id="microphone" class="microphone" onclick="toggleRecording()">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </button>
            </div>
            
            <input type="text" id="answerInput" class="answer-input" placeholder="Votre réponse ou cliquez sur le micro">
            
            <div id="message" class="message" style="display: none;"></div>
            
            <div class="buttons-row">
                <button class="btn btn-small btn-reveal" onclick="showAnswer()">Montrer la réponse</button>
                <button class="btn btn-small btn-conjugation" onclick="toggleConjugation()">Voir la conjugaison</button>
            </div>
            
            <div id="conjugationTable" class="conjugation-table"></div>
        </div>
    </div>

    <script>
        // Base de données de verbes
        const verbs = [
            // Groupe 1 (-er)
            "aimer", "parler", "manger", "chanter", "danser", "travailler", "étudier", "jouer", "regarder", "écouter",
            "habiter", "arriver", "partir", "entrer", "sortir", "monter", "descendre", "tomber", "rester", "aller",
            "venir", "retourner", "passer", "visiter", "voyager", "préparer", "organiser", "planifier", "commencer",
            "continuer", "finir", "arrêter", "essayer", "oublier", "chercher", "trouver", "perdre", "gagner",
            "acheter", "payer", "emprunter", "prêter", "donner", "recevoir", "apporter", "emporter", "envoyer",
            "montrer", "présenter", "expliquer", "démontrer", "prouver", "affirmer", "déclarer", "annoncer",
            "proposer", "suggérer", "recommander", "conseiller", "aider", "sauver", "protéger", "défendre",
            "attaquer", "combattre", "résister", "supporter", "accepter", "refuser", "accepter", "accueillir",
            "inviter", "remercier", "féliciter", "encourager", "motiver", "inspirer", "créer", "inventer",
            "découvrir", "explorer", "rechercher", "analyser", "examiner", "observer", "remarquer", "noter",
            "enregistrer", "sauvegarder", "imprimer", "copier", "coller", "couper", "détruire", "jeter",
            "recycler", "nettoyer", "laver", "essuyer", "balayer", "ranger", "organiser", "désordonner",
            "remplir", "vider", "ouvrir", "fermer", "verrouiller", "déverrouiller", "construire", "bâtir",
            "détruire", "démolir", "réparer", "améliorer", "renover", "décorer", "peindre", "colorier",
            "dessiner", "sketcher", "photographier", "filmer", "enregistrer", "jouer", "danser", "chanter",
            "composer", "écrire", "lire", "relire", "corriger", "modifier", "éditer", "publier",
            "imprimer", "diffuser", "transmettre", "communiquer", "discuter", "parler", "bavarder",
            "se taire", "écouter", "entendre", "comprendre", "interpréter", "traduire", "apprendre",
            "étudier", "réviser", "mémoriser", "retenir", "oublier", "se souvenir", "rappeler",
            "imaginer", "rêver", "penser", "réfléchir", "méditer", "contempler", "observer", "regarder",
            "voir", "apercevoir", "distinguer", "reconnaître", "identifier", "nommer", "désigner",
            "choisir", "sélectionner", "opter", "décider", "déterminer", "fixer", "établir", "instaurer",
            "introduire", "intégrer", "incorporer", "inclure", "exclure", "éliminer", "supprimer",
            "effacer", "annuler", "retirer", "reprendre", "récupérer", "récupérer", "récupérer",
            
            // Groupe 2 (-ir)
            "finir", "choisir", "grandir", "vieillir", "maigrir", "grossir", "rougir", "pâlir",
            "jaunir", "noircir", "blanchir", "ramollir", "durcir", "affaiblir", "fortifier",
            "enrichir", "appauvrir", "allonger", "raccourcir", "élargir", "rétrécir", "approfondir",
            "survoler", "atterrir", "décoller", "atterrir", "envoler", "s'envoler", "redescendre",
            "remonter", "redescendre", "remonter", "redescendre", "s'élever", "s'abaisser",
            "s'allonger", "se raccourcir", "s'élargir", "se rétrécir", "s'approfondir",
            "s'affaiblir", "se fortifier", "s'enrichir", "s'appauvrir", "se ramollir",
            "se durcir", "se rougir", "se pâlir", "se jaunir", "se noircir", "se blanchir",
            
            // Groupe 3 (irréguliers)
            "avoir", "être", "faire", "aller", "venir", "devoir", "pouvoir", "savoir",
            "vouloir", "falloir", "pleuvoir", "voir", "prendre", "comprendre", "apprendre",
            "surprendre", "reprendre", "entreprendre", "boire", "croire", "lire", "dire",
            "écrire", "rire", "sourire", "ouvrir", "couvrir", "découvrir", "recouvrir",
            "offrir", "souffrir", "cueillir", "accueillir", "recueillir", "vêtir",
            "sortir", "partir", "dormir", "servir", "sentir", "mentir", "départir",
            "repartir", "consentir", "ressentir", "repentir", "se repentir", "se servir",
            "s'endormir", "se départir", "se repentir", "se vêtir", "s'asseoir",
            "se taire", "se plaindre", "se déplaire", "se rire", "se sourire",
            "s'écrire", "se lire", "se dire", "se boire", "se croire", "se voir",
            "s'ouvrir", "se couvrir", "se découvrir", "se recouvrir", "s'offrir",
            "se souffrir", "se cueillir", "s'accueillir", "se recueillir",
            "naître", "mourir", "courir", "parcourir", "secourir", "fuir",
            "s'enfuir", "conclure", "inclure", "exclure", "interrompre",
            "rompre", "corrompre", "rompre", "résoudre", "absoudre", "dissoudre",
            "coudre", "moudre", "émoudre", "rendre", "vendre", "pendre",
            "défendre", "attendre", "entendre", "répondre", "correspondre",
            "confondre", "fondre", "tondre", "plaire", "taire", "extraire",
            "soustraire", "distraire", "traire", "contraindre", "plaindre",
            "éteindre", "teindre", "craindre", "joindre", "rejoindre",
            "poindre", "oindre", "graaître", "paître", "repaaître", "braire",
            "clore", "fiche", "affiger", "fugir", "garir", "haïr", "quérir"
        ];

        // Temps de conjugaison
        const tenses = {
            1: [ // Niveau 1
                "présent", "futur", "imparfait"
            ],
            2: [ // Niveau 2
                "présent", "futur", "imparfait", "passé simple", "plus-que-parfait", "subjonctif"
            ],
            3: [ // Niveau 3 - Tous les temps
                "présent", "imparfait", "futur", "passé simple", "passé composé",
                "plus-que-parfait", "passé antérieur", "futur antérieur",
                "subjonctif présent", "subjonctif passé", "subjonctif imparfait", "subjonctif plus-que-parfait",
                "conditionnel présent", "conditionnel passé",
                "impératif présent", "impératif passé",
                "infinitif présent", "infinitif passé",
                "participe présent", "participe passé",
                "gérondif présent", "gérondif passé"
            ]
        };

        // Pronoms
        const pronouns = [
            { text: "je", display: "je" },
            { text: "tu", display: "tu" },
            { text: "il", display: "il" },
            { text: "elle", display: "elle" },
            { text: "nous", display: "nous" },
            { text: "vous", display: "vous" },
            { text: "ils", display: "ils" },
            { text: "elles", display: "elles" }
        ];

        // Variables globales
        let currentLevel = 1;
        let currentTimer = 0;
        let currentScore = 0;
        let currentVerb = "";
        let currentTense = "";
        let currentPronoun = "";
        let correctAnswer = "";
        let isRecording = false;
        let recognition = null;
        let timerInterval = null;
        let timeRemaining = 0;

        // Initialisation
        window.onload = function() {
            loadLeaderboard();
            initializeSpeechRecognition();
        };

        // Sélection du niveau
        function selectLevel(level) {
            currentLevel = level;
            document.querySelectorAll('.btn-level').forEach(btn => {
                btn.style.background = 'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)';
            });
            event.target.style.background = 'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)';
        }

        // Sélection du timer
        function selectTimer(minutes) {
            currentTimer = minutes;
            document.querySelectorAll('.timer-selection .btn').forEach(btn => {
                btn.style.background = 'linear-gradient(45deg, #4facfe 0%, #00f2fe 100%)';
            });
            event.target.style.background = 'linear-gradient(45deg, #f093fb 0%, #f5576c 100%)';
        }

        // Initialisation de la reconnaissance vocale
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'fr-FR';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    document.getElementById('answerInput').value = transcript;
                    checkAnswer(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Erreur de reconnaissance:', event.error);
                    stopRecording();
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        // Toggle enregistrement
        function toggleRecording() {
            if (!recognition) {
                alert('La reconnaissance vocale n\'est pas supportée par votre navigateur');
                return;
            }
            
            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
                isRecording = true;
                document.getElementById('microphone').classList.add('recording');
            }
        }

        // Arrêter l'enregistrement
        function stopRecording() {
            isRecording = false;
            document.getElementById('microphone').classList.remove('recording');
        }

        // Commencer le jeu
        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Veuillez entrer votre nom');
                return;
            }
            
            localStorage.setItem('playerName', playerName);
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameArea').classList.add('active');
            
            if (currentTimer > 0) {
                timeRemaining = currentTimer * 60;
                startTimer();
            }
            
            generateQuestion();
        }

        // Timer
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Générer une question
        function generateQuestion() {
            currentVerb = verbs[Math.floor(Math.random() * verbs.length)];
            currentTense = tenses[currentLevel][Math.floor(Math.random() * tenses[currentLevel].length)];
            currentPronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
            
            correctAnswer = conjugateVerb(currentVerb, currentTense, currentPronoun.text);
            
            const questionText = `Conjugue le verbe <span class="verb">${currentVerb}</span> 
                                 <span class="tense">au ${currentTense}</span> 
                                 <span class="pronoun">à la ${getPronounDescription(currentPronoun.text)}</span>`;
            
            document.getElementById('question').innerHTML = questionText;
            document.getElementById('answerInput').value = '';
            document.getElementById('message').style.display = 'none';
            document.getElementById('conjugationTable').classList.remove('active');
            
            // Énoncer la question
            speakQuestion();
        }

        // Obtenir la description du pronom
        function getPronounDescription(pronoun) {
            const descriptions = {
                "je": "première personne du singulier (je)",
                "tu": "deuxième personne du singulier (tu)",
                "il": "troisième personne du singulier (il)",
                "elle": "troisième personne du singulier (elle)",
                "nous": "première personne du pluriel (nous)",
                "vous": "deuxième personne du pluriel (vous)",
                "ils": "troisième personne du pluriel (ils)",
                "elles": "troisième personne du pluriel (elles)"
            };
            return descriptions[pronoun];
        }

        // Conjugaison des verbes
        function conjugateVerb(verb, tense, pronoun) {
            // Simplification de la conjugaison - en réalité, cela nécessiterait une base de données complète
            // Pour cette démo, nous utilisons des règles de base
            
            // Exceptions courantes
            const exceptions = {
                "avoir": {
                    "présent": { "je": "j'ai", "tu": "as", "il": "a", "nous": "avons", "vous": "avez", "ils": "ont" },
                    "imparfait": { "je": "j'avais", "tu": "avais", "il": "avait", "nous": "avions", "vous": "aviez", "ils": "avaient" },
                    "futur": { "je": "aurai", "tu": "auras", "il": "aura", "nous": "aurons", "vous": "aurez", "ils": "auront" }
                },
                "être": {
                    "présent": { "je": "suis", "tu": "es", "il": "est", "nous": "sommes", "vous": "êtes", "ils": "sont" },
                    "imparfait": { "je": "étais", "tu": "étais", "il": "était", "nous": "étions", "vous": "étiez", "ils": "étaient" },
                    "futur": { "je": "serai", "tu": "seras", "il": "sera", "nous": "serons", "vous": "serez", "ils": "seront" }
                },
                "faire": {
                    "présent": { "je": "fais", "tu": "fais", "il": "fait", "nous": "faisons", "vous": "faites", "ils": "font" },
                    "imparfait": { "je": "faisais", "tu": "faisais", "il": "faisait", "nous": "faisions", "vous": "faisiez", "ils": "faisaient" },
                    "futur": { "je": "ferai", "tu": "feras", "il": "fera", "nous": "ferons", "vous": "ferez", "ils": "feront" }
                },
                "aller": {
                    "présent": { "je": "vais", "tu": "vas", "il": "va", "nous": "allons", "vous": "allez", "ils": "vont" },
                    "imparfait": { "je": "allais", "tu": "allais", "il": "allait", "nous": "allions", "vous": "alliez", "ils": "allaient" },
                    "futur": { "je": "irai", "tu": "iras", "il": "ira", "nous": "irons", "vous": "irez", "ils": "iront" }
                },
                "venir": {
                    "présent": { "je": "viens", "tu": "viens", "il": "vient", "nous": "venons", "vous": "venez", "ils": "viennent" },
                    "imparfait": { "je": "venais", "tu": "venais", "il": "venait", "nous": "venions", "vous": "veniez", "ils": "venaient" },
                    "futur": { "je": "viendrai", "tu": "viendras", "il": "viendra", "nous": "viendrons", "vous": "viendrez", "ils": "viendront" }
                }
            };
            
            // Vérifier les exceptions
            if (exceptions[verb] && exceptions[verb][tense]) {
                return exceptions[verb][tense][pronoun] || verb;
            }
            
            // Conjugaison de base pour les verbes réguliers
            let stem = verb.slice(0, -2);
            let ending = verb.slice(-2);
            
            if (tense === "présent") {
                if (ending === "er") {
                    const endings = { "je": "e", "tu": "es", "il": "e", "nous": "ons", "vous": "ez", "ils": "ent" };
                    let conjugated = stem + endings[pronoun];
                    // Gérer l'élision
                    if (pronoun === "je" && /^[aeiou]/.test(conjugated)) {
                        conjugated = "j'" + conjugated;
                    }
                    return conjugated;
                } else if (ending === "ir") {
                    const endings = { "je": "is", "tu": "is", "il": "it", "nous": "issons", "vous": "issez", "ils": "issent" };
                    return stem + endings[pronoun];
                }
            } else if (tense === "imparfait") {
                // Pour l'imparfait, utiliser la base de la première personne du pluriel
                let base = stem + "ons"; // simplification
                const endings = { "je": "ais", "tu": "ais", "il": "ait", "nous": "ions", "vous": "iez", "ils": "aient" };
                let conjugated = base.slice(0, -3) + endings[pronoun];
                if (pronoun === "je" && /^[aeiou]/.test(conjugated)) {
                    conjugated = "j'" + conjugated;
                }
                return conjugated;
            } else if (tense === "futur") {
                const endings = { "je": "ai", "tu": "as", "il": "a", "nous": "ons", "vous": "ez", "ils": "ont" };
                return verb + endings[pronoun];
            }
            
            return verb; // Par défaut
        }

        // Vérifier la réponse
        function checkAnswer(userAnswer) {
            // Nettoyer la réponse
            userAnswer = userAnswer.toLowerCase().trim();
            
            // Vérifier les formes alternatives
            const alternatives = [correctAnswer.toLowerCase()];
            
            // Gérer les élisions
            if (correctAnswer.startsWith("j'")) {
                alternatives.push(correctAnswer.replace("j'", "je "));
            }
            
            // Vérifier la réponse
            if (alternatives.some(alt => userAnswer === alt)) {
                // Bonne réponse
                currentScore += 5;
                updateScore();
                showMessage("Bravo ! C'est super !", "success");
                speak("Bravo !");
                
                setTimeout(() => {
                    generateQuestion();
                }, 2000);
            } else {
                // Mauvaise réponse
                currentScore -= 5;
                updateScore();
                showMessage("Erreur ! Tu peux le faire, réessaie !", "error");
                speak("Erreur !");
                document.getElementById('answerInput').value = '';
            }
        }

        // Afficher un message
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
        }

        // Mettre à jour le score
        function updateScore() {
            document.getElementById('scoreValue').textContent = currentScore;
        }

        // Montrer la réponse
        function showAnswer() {
            const answerWithPronoun = `${currentPronoun.display} ${correctAnswer}`;
            showMessage(`La bonne réponse est : ${answerWithPronoun}`, "success");
            speak(answerWithPronoun);
        }

        // Basculer l'affichage de la conjugaison
        function toggleConjugation() {
            const table = document.getElementById('conjugationTable');
            if (table.classList.contains('active')) {
                table.classList.remove('active');
            } else {
                showConjugationTable();
            }
        }

        // Afficher le tableau de conjugaison
        function showConjugationTable() {
            const table = document.getElementById('conjugationTable');
            let html = `<h3>Conjugaison de ${currentVerb}</h3>`;
            
            // Pour la démo, afficher quelques temps principaux
            const mainTenses = ["présent", "imparfait", "futur"];
            
            html += '<table>';
            html += '<tr><th>Temps</th><th>Je</th><th>Tu</th><th>Il/Elle</th><th>Nous</th><th>Vous</th><th>Ils/Elles</th></tr>';
            
            mainTenses.forEach(tense => {
                html += '<tr>';
                html += `<td>${tense}</td>`;
                pronouns.forEach(pronoun => {
                    const conjugated = conjugateVerb(currentVerb, tense, pronoun.text);
                    html += `<td>${conjugated}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</table>';
            table.innerHTML = html;
            table.classList.add('active');
        }

        // Fonction de synthèse vocale
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                speechSynthesis.speak(utterance);
            }
        }

        // Énoncer la question
        function speakQuestion() {
            const questionText = `Conjugue le verbe ${currentVerb} au ${currentTense} à la ${getPronounDescription(currentPronoun.text)}`;
            speak(questionText);
        }

        // Charger le tableau des scores
        function loadLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            const entries = document.getElementById('leaderboardEntries');
            
            entries.innerHTML = '';
            leaderboard.sort((a, b) => b.score - a.score).slice(0, 5).forEach(entry => {
                const div = document.createElement('div');
                div.className = 'leaderboard-entry';
                div.innerHTML = `<span>${entry.name}</span><span>${entry.score} pts</span>`;
                entries.appendChild(div);
            });
        }

        // Sauvegarder le score
        function saveScore() {
            const playerName = localStorage.getItem('playerName');
            if (!playerName) return;
            
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            leaderboard.push({
                name: playerName,
                score: currentScore,
                date: new Date().toISOString()
            });
            
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
        }

        // Fin du jeu
        function endGame() {
            saveScore();
            alert(`Jeu terminé ! Votre score : ${currentScore} points`);
            location.reload();
        }

        // Gestion de la saisie
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer(this.value);
            }
        });

        // Empêcher la fermeture accidentelle
        window.addEventListener('beforeunload', function(e) {
            if (currentScore > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
