<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma√Ætre de la Conjugaison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 800px;
            width: 90%;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .menu-container {
            display: none;
            text-align: center;
        }

        .menu-container.active {
            display: block;
        }

        .level-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.level {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .btn.timer {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            margin: 5px;
        }

        .game-container {
            display: none;
            text-align: center;
        }

        .game-container.active {
            display: block;
        }

        .question {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }

        .verb { color: #ff6b6b; }
        .tense { color: #4ecdc4; }
        .pronoun { color: #ffe66d; }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .microphone-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 2em;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px;
        }

        .microphone-btn:hover {
            transform: scale(1.1);
        }

        .microphone-btn.recording {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .score-display {
            font-size: 1.5em;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .message {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: fadeIn 0.5s ease;
        }

        .success {
            background: rgba(76, 175, 80, 0.8);
            color: white;
        }

        .error {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .conjugation-table {
            display: none;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .conjugation-table.active {
            display: block;
        }

        .conjugation-table h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .conjugation-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .conjugation-table td, .conjugation-table th {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .conjugation-table th {
            background: #667eea;
            color: white;
        }

        .timer-display {
            font-size: 2em;
            margin: 20px 0;
            text-align: center;
        }

        .name-input {
            padding: 10px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .leaderboard {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
        }

        .leaderboard h3 {
            margin-bottom: 10px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <div class="glass-container">
        <h1>Ma√Ætre de la Conjugaison</h1>
        
        <div id="startMenu" class="menu-container active">
            <input type="text" id="playerName" class="name-input" placeholder="Entrez votre nom">
            <div class="level-buttons">
                <button class="btn level" onclick="selectLevel(1)">Niveau 1</button>
                <button class="btn level" onclick="selectLevel(2)">Niveau 2</button>
                <button class="btn level" onclick="selectLevel(3)">Niveau 3</button>
            </div>
            <div>
                <p>Choisir le temps:</p>
                <button class="btn timer" onclick="selectTimer(15)">15 min</button>
                <button class="btn timer" onclick="selectTimer(10)">10 min</button>
                <button class="btn timer" onclick="selectTimer(5)">5 min</button>
                <button class="btn timer" onclick="selectTimer(0)">Sans limite</button>
            </div>
            <button class="btn" onclick="startGame()">Commencer</button>
            <div id="leaderboard" class="leaderboard"></div>
        </div>

        <div id="gameContainer" class="game-container">
            <div class="score-display">Score: <span id="score">0</span></div>
            <div id="timer" class="timer-display"></div>
            
            <div id="question" class="question"></div>
            
            <input type="text" id="answerInput" class="answer-input" placeholder="Votre r√©ponse">
            
            <button id="microphoneBtn" class="microphone-btn" onclick="toggleRecording()">üé§</button>
            
            <div id="message" class="message" style="display: none;"></div>
            
            <div class="buttons-container">
                <button class="btn" onclick="checkAnswer()">V√©rifier</button>
                <button class="btn" onclick="showAnswer()">Voir la r√©ponse</button>
                <button class="btn" onclick="toggleConjugationTable()">Tableau de conjugaison</button>
                <button class="btn" onclick="nextQuestion()">Question suivante</button>
            </div>
            
            <div id="conjugationTable" class="conjugation-table"></div>
        </div>
    </div>

    <script>
        // Base de donn√©es de verbes
        const verbs = [
            // 3000 verbes fran√ßais organis√©s par groupe
            { infinitif: "avoir", groupe: 3 },
            { infinitif: "√™tre", groupe: 3 },
            { infinitif: "aller", groupe: 3 },
            { infinitif: "faire", groupe: 3 },
            { infinitif: "prendre", groupe: 3 },
            { infinitif: "voir", groupe: 3 },
            { infinitif: "venir", groupe: 3 },
            { infinitif: "savoir", groupe: 3 },
            { infinitif: "pouvoir", groupe: 3 },
            { infinitif: "vouloir", groupe: 3 },
            // Ajoutez ici les 2990 autres verbes
        ];

        // Temps verbaux par niveau
        const tensesByLevel = {
            1: ["pr√©sent", "futur", "imparfait"],
            2: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent"],
            3: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent", 
                "subjonctif pass√©", "conditionnel pr√©sent", "conditionnel pass√©", "imp√©ratif", 
                "infinitif", "participe pr√©sent", "participe pass√©", "pass√© compos√©", "pass√© ant√©rieur",
                "futur ant√©rieur", "subjonctif imparfait", "subjonctif plus-que-parfait", "conditionnel pass√© II",
                "pass√© surcompos√©", "futur proche"]
        };

        // Pronoms
        const pronouns = [
            { text: "je", person: "1s" },
            { text: "tu", person: "2s" },
            { text: "il/elle", person: "3s" },
            { text: "nous", person: "1p" },
            { text: "vous", person: "2p" },
            { text: "ils/elles", person: "3p" }
        ];

        // Variables globales
        let currentLevel = 1;
        let currentTimer = 0;
        let score = 0;
        let currentVerb = null;
        let currentTense = null;
        let currentPronoun = null;
        let correctAnswer = "";
        let timerInterval = null;
        let timeRemaining = 0;
        let playerName = "";
        let recognition = null;

        // Initialisation
        window.onload = function() {
            loadLeaderboard();
            initializeSpeechRecognition();
        };

        // Reconnaissance vocale
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'fr-FR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    document.getElementById('answerInput').value = transcript;
                    checkAnswer();
                };

                recognition.onerror = function(event) {
                    console.error('Erreur de reconnaissance vocale:', event.error);
                    document.getElementById('microphoneBtn').classList.remove('recording');
                };

                recognition.onend = function() {
                    document.getElementById('microphoneBtn').classList.remove('recording');
                };
            }
        }

        // Fonctions de jeu
        function selectLevel(level) {
            currentLevel = level;
        }

        function selectTimer(minutes) {
            currentTimer = minutes;
        }

        function startGame() {
            playerName = document.getElementById('playerName').value || 'Joueur';
            document.getElementById('startMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            if (currentTimer > 0) {
                timeRemaining = currentTimer * 60;
                startTimer();
            }
            
            nextQuestion();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function nextQuestion() {
            // R√©initialiser l'interface
            document.getElementById('answerInput').value = '';
            document.getElementById('message').style.display = 'none';
            document.getElementById('conjugationTable').classList.remove('active');
            
            // Choisir al√©atoirement
            currentVerb = verbs[Math.floor(Math.random() * verbs.length)];
            const tenses = tensesByLevel[currentLevel];
            currentTense = tenses[Math.floor(Math.random() * tenses.length)];
            currentPronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
            
            // G√©n√©rer la r√©ponse correcte
            correctAnswer = conjugate(currentVerb.infinitif, currentTense, currentPronoun.person);
            
            // Afficher la question
            const questionText = `Conjugue le verbe <span class="verb">${currentVerb.infinitif}</span> 
                                 <span class="tense">√† l'${currentTense}</span> 
                                 <span class="pronoun">${getPersonText(currentPronoun.person)}</span>`;
            document.getElementById('question').innerHTML = questionText;
            
            // Lire la question
            speak(questionText.replace(/<[^>]*>/g, ''));
        }

        function getPersonText(person) {
            const personMap = {
                '1s': '√† la premi√®re personne du singulier (je)',
                '2s': '√† la deuxi√®me personne du singulier (tu)',
                '3s': '√† la troisi√®me personne du singulier (il/elle)',
                '1p': '√† la premi√®re personne du pluriel (nous)',
                '2p': '√† la deuxi√®me personne du pluriel (vous)',
                '3p': '√† la troisi√®me personne du pluriel (ils/elles)'
            };
            return personMap[person];
        }

        function conjugate(verb, tense, person) {
            // Fonction simplifi√©e de conjugaison
            // Dans une vraie application, vous auriez besoin d'une base de donn√©es compl√®te
            const conjugations = {
                "avoir": {
                    "pr√©sent": { "1s": "ai", "2s": "as", "3s": "a", "1p": "avons", "2p": "avez", "3p": "ont" },
                    "imparfait": { "1s": "avais", "2s": "avais", "3s": "avait", "1p": "avions", "2p": "aviez", "3p": "avaient" },
                    "futur": { "1s": "aurai", "2s": "auras", "3s": "aura", "1p": "aurons", "2p": "aurez", "3p": "auront" }
                },
                "√™tre": {
                    "pr√©sent": { "1s": "suis", "2s": "es", "3s": "est", "1p": "sommes", "2p": "√™tes", "3p": "sont" },
                    "imparfait": { "1s": "√©tais", "2s": "√©tais", "3s": "√©tait", "1p": "√©tions", "2p": "√©tiez", "3p": "√©taient" },
                    "futur": { "1s": "serai", "2s": "seras", "3s": "sera", "1p": "serons", "2p": "serez", "3p": "seront" }
                }
            };
            
            if (conjugations[verb] && conjugations[verb][tense] && conjugations[verb][tense][person]) {
                return conjugations[verb][tense][person];
            }
            
            // Retour par d√©faut pour les verbes non r√©pertori√©s
            return "inconnu";
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.toLowerCase().trim();
            const messageDiv = document.getElementById('message');
            
            if (userAnswer === correctAnswer) {
                score += 5;
                document.getElementById('score').textContent = score;
                messageDiv.className = 'message success';
                const messages = ['Bravo !', 'C\'est super !', 'Formidable !', 'C\'est g√©nial !'];
                messageDiv.textContent = messages[Math.floor(Math.random() * messages.length)];
                messageDiv.style.display = 'block';
                speak(messageDiv.textContent);
                
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            } else {
                score -= 5;
                document.getElementById('score').textContent = score;
                messageDiv.className = 'message error';
                messageDiv.innerHTML = 'Erreur !<br>';
                const encouragements = ['Tu peux le faire !', 'Allez, continue !', 'R√©fl√©chis bien !'];
                messageDiv.innerHTML += encouragements[Math.floor(Math.random() * encouragements.length)];
                messageDiv.style.display = 'block';
                speak('Erreur ! ' + encouragements[Math.floor(Math.random() * encouragements.length)]);
                
                document.getElementById('answerInput').value = '';
            }
        }

        function showAnswer() {
            document.getElementById('answerInput').value = correctAnswer;
            speak(`La r√©ponse est : ${correctAnswer}`);
        }

        function toggleConjugationTable() {
            const table = document.getElementById('conjugationTable');
            if (table.classList.contains('active')) {
                table.classList.remove('active');
            } else {
                generateConjugationTable();
                table.classList.add('active');
            }
        }

        function generateConjugationTable() {
            const table = document.getElementById('conjugationTable');
            let html = `<h3>Conjugaison de ${currentVerb.infinitif}</h3>`;
            
            const tenses = tensesByLevel[currentLevel];
            html += '<table>';
            
            // En-t√™te
            html += '<tr><th>Temps</th>';
            pronouns.forEach(p => html += `<th>${p.text}</th>`);
            html += '</tr>';
            
            // Corps du tableau
            tenses.forEach(tense => {
                html += `<tr><th>${tense}</th>`;
                pronouns.forEach(pronoun => {
                    const conjugation = conjugate(currentVerb.infinitif, tense, pronoun.person);
                    html += `<td>${conjugation}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</table>';
            table.innerHTML = html;
        }

        function toggleRecording() {
            if (!recognition) {
                alert('La reconnaissance vocale n\'est pas support√©e par votre navigateur.');
                return;
            }
            
            const btn = document.getElementById('microphoneBtn');
            if (btn.classList.contains('recording')) {
                recognition.stop();
                btn.classList.remove('recording');
            } else {
                recognition.start();
                btn.classList.add('recording');
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                speechSynthesis.speak(utterance);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            saveScore();
            alert(`Partie termin√©e ! Votre score final est de ${score} points.`);
            location.reload();
        }

        function saveScore() {
            const leaderboard = JSON.parse(localStorage.getItem('conjugationLeaderboard') || '[]');
            leaderboard.push({ name: playerName, score: score, date: new Date().toISOString() });
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard.splice(10); // Garder les 10 meilleurs
            localStorage.setItem('conjugationLeaderboard', JSON.stringify(leaderboard));
        }

        function loadLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('conjugationLeaderboard') || '[]');
            const leaderboardDiv = document.getElementById('leaderboard');
            
            if (leaderboard.length > 0) {
                let html = '<h3>Meilleurs scores</h3>';
                leaderboard.forEach((entry, index) => {
                    html += `<div class="leaderboard-entry">
                        <span>${index + 1}. ${entry.name}</span>
                        <span>${entry.score} pts</span>
                    </div>`;
                });
                leaderboardDiv.innerHTML = html;
            }
        }

        // Gestionnaire d'√©v√©nements pour la touche Entr√©e
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
    </script>
</body>
</html>
