<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma√Ætre de la Conjugaison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .menu-screen, .game-screen, .score-screen {
            display: none;
        }

        .menu-screen.active, .game-screen.active, .score-screen.active {
            display: block;
        }

        .button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }

        .button.info {
            background: linear-gradient(45deg, #0984e3, #0652DD);
        }

        .button.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }

        .button.danger {
            background: linear-gradient(45deg, #d63031, #b71c1c);
        }

        .mic-button {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin: 20px auto;
            position: relative;
        }

        .mic-button.recording {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(108, 92, 231, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }
        }

        .question {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border-left: 5px solid #6c5ce7;
        }

        .verb { color: #e17055; font-weight: bold; }
        .tense { color: #0984e3; font-weight: bold; }
        .pronoun { color: #00b894; font-weight: bold; }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            transition: border-color 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #6c5ce7;
        }

        .score-display {
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
            color: #6c5ce7;
            font-weight: bold;
        }

        .conjugation-table {
            display: none;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
        }

        .conjugation-table.active {
            display: block;
        }

        .conjugation-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .conjugation-table th, .conjugation-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .conjugation-table th {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
        }

        .timer-display {
            font-size: 1.2em;
            text-align: center;
            margin: 20px 0;
            color: #d63031;
            font-weight: bold;
        }

        .encouragement {
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .encouragement.success {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
        }

        .encouragement.error {
            background: linear-gradient(45deg, #d63031, #b71c1c);
            color: white;
        }

        .name-input {
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px;
        }

        .level-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .timer-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .button {
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Ma√Ætre de la Conjugaison</h1>
        
        <!-- Menu Principal -->
        <div class="menu-screen active">
            <div class="level-selection">
                <h3>Choisissez votre niveau :</h3>
                <button class="button" onclick="selectLevel(1)">Niveau 1 (Pr√©sent, Futur, Imparfait)</button>
                <button class="button" onclick="selectLevel(2)">Niveau 2 (+ Pass√© simple, Plus-que-parfait, Subjonctif)</button>
                <button class="button" onclick="selectLevel(3)">Niveau 3 (21 temps)</button>
            </div>
            
            <div class="timer-selection">
                <h3>Temps de jeu :</h3>
                <button class="button warning" onclick="selectTimer(15)">15 minutes</button>
                <button class="button warning" onclick="selectTimer(10)">10 minutes</button>
                <button class="button warning" onclick="selectTimer(5)">5 minutes</button>
                <button class="button info" onclick="selectTimer(0)">Sans limite</button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <input type="text" class="name-input" id="playerName" placeholder="Entrez votre nom" value="">
                <button class="button success" onclick="startGame()">Commencer</button>
            </div>
            
            <div class="stats">
                <h3>Statistiques :</h3>
                <p>Total de verbes : <span id="totalVerbs">3000</span></p>
                <p>Meilleur score : <span id="bestScore">0</span></p>
                <p>Dernier joueur : <span id="lastPlayer">-</span></p>
            </div>
        </div>
        
        <!-- √âcran de Jeu -->
        <div class="game-screen">
            <div class="timer-display" id="timerDisplay"></div>
            
            <div class="question" id="question">
                <span class="verb">verbe</span> au <span class="tense">temps</span> √† la <span class="pronoun">pronom</span>
            </div>
            
            <div class="score-display">Score : <span id="currentScore">0</span></div>
            
            <input type="text" class="answer-input" id="answerInput" placeholder="Votre r√©ponse..." disabled>
            
            <button class="mic-button" id="micButton" onclick="toggleRecording()">
                üé§
            </button>
            
            <div class="encouragement" id="encouragement" style="display: none;"></div>
            
            <div style="text-align: center;">
                <button class="button info" onclick="showAnswer()">Montrer la r√©ponse</button>
                <button class="button warning" onclick="toggleConjugationTable()">Table de conjugaison</button>
                <button class="button danger" onclick="backToMenu()">Retour au menu</button>
            </div>
            
            <div class="conjugation-table" id="conjugationTable">
                <table id="conjugationContent"></table>
            </div>
        </div>
        
        <!-- √âcran des Scores -->
        <div class="score-screen">
            <h2>Tableau des Scores</h2>
            <div id="scoreTable"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="button" onclick="backToMenu()">Retour au menu</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentLevel = 1;
        let currentTimer = 0;
        let score = 0;
        let currentVerb = null;
        let currentTense = null;
        let currentPronoun = null;
        let correctAnswer = null;
        let isRecording = false;
        let recognition = null;
        let synth = window.speechSynthesis;
        let timerInterval = null;
        let timeRemaining = 0;
        let gameActive = false;

        // Base de donn√©es de verbes (3000 verbes)
        const verbs = [
            // Groupe 1 (-er) - 1500 verbes
            "aimer", "parler", "manger", "chanter", "danser", "travailler", "√©tudier", "jouer", "regarder", "√©couter",
            "t√©l√©phoner", "arriver", "partir", "entrer", "sortir", "monter", "descendre", "aller", "venir", "revenir",
            "passer", "rester", "tomber", "na√Ætre", "mourir", "grandir", "vieillir", "maigrir", "grossir", "rougir",
            "blanchir", "noircir", "jaunir", "verdir", "s√©cher", "mouiller", "nettoyer", "salir", "r√©parer", "casser",
            "construire", "d√©truire", "acheter", "vendre", "payer", "gagner", "perdre", "trouver", "chercher", "perdre",
            // ... (continue avec 1500 verbes en -er)
            
            // Groupe 2 (-ir) - 750 verbes
            "finir", "choisir", "ob√©ir", "r√©ussir", "grandir", "rougir", "maigrir", "grossir", "vieillir", "jaunir",
            "verdir", "s√©cher", "mouiller", "nettoyer", "salir", "r√©fl√©chir", "agir", "b√¢tir", "nourrir", "gu√©rir",
            "punir", "r√©unir", "unir", "diviser", "multiplier", "ajouter", "soustraire", "remplir", "vider", "couvrir",
            "d√©couvrir", "ouvrir", "fermer", "r√©pondre", "attendre", "d√©fendre", "entendre", "vendre", "rendre", "perdre",
            // ... (continue avec 750 verbes en -ir)
            
            // Groupe 3 (-re, -oir, irr√©guliers) - 750 verbes
            "√™tre", "avoir", "faire", "aller", "venir", "prendre", "comprendre", "apprendre", "surprendre", "reprendre",
            "mettre", "permettre", "remettre", "promettre", "admettre", "transmettre", "soumettre", "commettre", "ouvrir", "couvrir",
            "d√©couvrir", "offrir", "souffrir", "cueillir", "bouillir", "dormir", "partir", "sortir", "servir", "sentir",
            "mentir", "seoir", "frire", "clore", "traire", "foutre", "pa√Ætre", "croire", "voir", "savoir",
            "pouvoir", "vouloir", "devoir", "mouvoir", "√©mouvoir", "promouvoir", "pleuvoir", "falloir", "valoir", "pr√©valoir",
            // ... (continue avec 750 verbes du 3e groupe)
        ];

        // Temps de conjugaison
        const tenses = {
            1: [
                { name: "pr√©sent", id: "present" },
                { name: "futur", id: "future" },
                { name: "imparfait", id: "imperfect" }
            ],
            2: [
                { name: "pr√©sent", id: "present" },
                { name: "futur", id: "future" },
                { name: "imparfait", id: "imperfect" },
                { name: "pass√© simple", id: "simplePast" },
                { name: "plus-que-parfait", id: "pluperfect" },
                { name: "subjonctif pr√©sent", id: "subjunctivePresent" }
            ],
            3: [
                { name: "pr√©sent", id: "present" },
                { name: "futur", id: "future" },
                { name: "imparfait", id: "imperfect" },
                { name: "pass√© simple", id: "simplePast" },
                { name: "plus-que-parfait", id: "pluperfect" },
                { name: "subjonctif pr√©sent", id: "subjunctivePresent" },
                { name: "subjonctif pass√©", id: "subjunctivePast" },
                { name: "subjonctif imparfait", id: "subjunctiveImperfect" },
                { name: "subjonctif plus-que-parfait", id: "subjunctivePluperfect" },
                { name: "conditionnel pr√©sent", id: "conditionalPresent" },
                { name: "conditionnel pass√©", id: "conditionalPast" },
                { name: "pass√© compos√©", id: "compoundPast" },
                { name: "pass√© ant√©rieur", id: "anteriorPast" },
                { name: "futur ant√©rieur", id: "futurePerfect" },
                { name: "imp√©ratif pr√©sent", id: "imperativePresent" },
                { name: "imp√©ratif pass√©", id: "imperativePast" },
                { name: "infinitif pr√©sent", id: "infinitivePresent" },
                { name: "infinitif pass√©", id: "infinitivePast" },
                { name: "participe pr√©sent", id: "presentParticiple" },
                { name: "participe pass√©", id: "pastParticiple" },
                { name: "g√©rondif pr√©sent", id: "gerundPresent" },
                { name: "g√©rondif pass√©", id: "gerundPast" }
            ]
        };

        // Pronoms
        const pronouns = [
            { text: "premi√®re personne du singulier", pronoun: "je", id: "je" },
            { text: "deuxi√®me personne du singulier", pronoun: "tu", id: "tu" },
            { text: "troisi√®me personne du singulier", pronoun: "il", id: "il" },
            { text: "premi√®re personne du pluriel", pronoun: "nous", id: "nous" },
            { text: "deuxi√®me personne du pluriel", pronoun: "vous", id: "vous" },
            { text: "troisi√®me personne du pluriel", pronoun: "ils", id: "ils" }
        ];

        // Conjugaison des verbes irr√©guliers
        const irregularConjugations = {
            "√™tre": {
                present: { je: "suis", tu: "es", il: "est", nous: "sommes", vous: "√™tes", ils: "sont" },
                imperfect: { je: "√©tais", tu: "√©tais", il: "√©tait", nous: "√©tions", vous: "√©tiez", ils: "√©taient" },
                future: { je: "serai", tu: "seras", il: "sera", nous: "serons", vous: "serez", ils: "seront" },
                simplePast: { je: "fus", tu: "fus", il: "fut", nous: "f√ªmes", vous: "f√ªtes", ils: "furent" },
                subjunctivePresent: { je: "sois", tu: "sois", il: "soit", nous: "soyons", vous: "soyez", ils: "soient" }
            },
            "avoir": {
                present: { je: "ai", tu: "as", il: "a", nous: "avons", vous: "avez", ils: "ont" },
                imperfect: { je: "avais", tu: "avais", il: "avait", nous: "avions", vous: "aviez", ils: "avaient" },
                future: { je: "aurai", tu: "auras", il: "aura", nous: "aurons", vous: "aurez", ils: "auront" },
                simplePast: { je: "eus", tu: "eus", il: "eut", nous: "e√ªmes", vous: "e√ªtes", ils: "eurent" },
                subjunctivePresent: { je: "aie", tu: "aies", il: "ait", nous: "ayons", vous: "ayez", ils: "aient" }
            },
            "faire": {
                present: { je: "fais", tu: "fais", il: "fait", nous: "faisons", vous: "faites", ils: "font" },
                imperfect: { je: "faisais", tu: "faisais", il: "faisait", nous: "faisions", vous: "faisiez", ils: "faisaient" },
                future: { je: "ferai", tu: "feras", il: "fera", nous: "ferons", vous: "ferez", ils: "feront" }
            },
            "aller": {
                present: { je: "vais", tu: "vas", il: "va", nous: "allons", vous: "allez", ils: "vont" },
                imperfect: { je: "allais", tu: "allais", il: "allait", nous: "allions", vous: "alliez", ils: "allaient" },
                future: { je: "irai", tu: "iras", il: "ira", nous: "irons", vous: "irez", ils: "iront" }
            }
            // ... (continue avec d'autres verbes irr√©guliers)
        };

        // Initialisation
        function init() {
            loadPlayerData();
            initSpeechRecognition();
            updateStats();
        }

        // Chargement des donn√©es du joueur
        function loadPlayerData() {
            const savedName = localStorage.getItem('playerName');
            if (savedName) {
                document.getElementById('playerName').value = savedName;
            }
            
            const bestScore = localStorage.getItem('bestScore');
            if (bestScore) {
                document.getElementById('bestScore').textContent = bestScore;
            }
            
            const lastPlayer = localStorage.getItem('lastPlayer');
            if (lastPlayer) {
                document.getElementById('lastPlayer').textContent = lastPlayer;
            }
        }

        // Initialisation de la reconnaissance vocale
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'fr-FR';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    document.getElementById('answerInput').value = transcript;
                    checkAnswer();
                };
                
                recognition.onerror = function(event) {
                    console.error('Erreur de reconnaissance:', event.error);
                    stopRecording();
                    speak("Je n'ai pas compris. Veuillez r√©essayer.");
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        // S√©lection du niveau
        function selectLevel(level) {
            currentLevel = level;
            document.querySelectorAll('.level-selection .button').forEach(btn => {
                btn.classList.remove('success');
            });
            event.target.classList.add('success');
        }

        // S√©lection du timer
        function selectTimer(minutes) {
            currentTimer = minutes;
            document.querySelectorAll('.timer-selection .button').forEach(btn => {
                btn.classList.remove('warning');
            });
            if (event && event.target) {
                event.target.classList.add('warning');
            }
        }

        // D√©but du jeu
        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Veuillez entrer votre nom');
                return;
            }
            
            localStorage.setItem('playerName', playerName);
            localStorage.setItem('lastPlayer', playerName);
            
            score = 0;
            document.getElementById('currentScore').textContent = score;
            
            document.querySelector('.menu-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
            
            gameActive = true;
            
            // D√©marrer le timer
            if (currentTimer > 0) {
                timeRemaining = currentTimer * 60;
                startTimer();
            }
            
            // Premi√®re question
            nextQuestion();
        }

        // Timer
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = currentTimer > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : "";
            document.getElementById('timerDisplay').textContent = display;
        }

        // Question suivante
        function nextQuestion() {
            if (!gameActive) return;
            
            // Choisir un verbe au hasard
            currentVerb = verbs[Math.floor(Math.random() * verbs.length)];
            
            // Choisir un temps selon le niveau
            const availableTenses = tenses[currentLevel];
            currentTense = availableTenses[Math.floor(Math.random() * availableTenses.length)];
            
            // Choisir un pronom
            const pronounData = pronouns[Math.floor(Math.random() * pronouns.length)];
            currentPronoun = pronounData;
            
            // Obtenir la bonne r√©ponse
            correctAnswer = getConjugation(currentVerb, currentTense.id, currentPronoun.id);
            
            // Afficher la question
            displayQuestion();
            
            // Vider le champ de r√©ponse
            document.getElementById('answerInput').value = '';
            
            // Cacher les encouragements
            document.getElementById('encouragement').style.display = 'none';
            
            // Cacher la table de conjugaison
            document.getElementById('conjugationTable').classList.remove('active');
            
            // Dire la question
            speakQuestion();
        }

        // Obtenir la conjugaison
        function getConjugation(verb, tense, pronoun) {
            // V√©rifier si c'est un verbe irr√©gulier
            if (irregularConjugations[verb] && irregularConjugations[verb][tense]) {
                return irregularConjugations[verb][tense][pronoun] || "";
            }
            
            // Conjugaison automatique pour les verbes r√©guliers
            return conjugateRegularVerb(verb, tense, pronoun);
        }

        // Conjugaison des verbes r√©guliers
        function conjugateRegularVerb(verb, tense, pronoun) {
            const endings = {
                er: {
                    present: { je: "e", tu: "es", il: "e", nous: "ons", vous: "ez", ils: "ent" },
                    imperfect: { je: "ais", tu: "ais", il: "ait", nous: "ions", vous: "iez", ils: "aient" },
                    future: { je: "erai", tu: "eras", il: "era", nous: "erons", vous: "erez", ils: "eront" }
                },
                ir: {
                    present: { je: "is", tu: "is", il: "it", nous: "issons", vous: "issez", ils: "issent" },
                    imperfect: { je: "issais", tu: "issais", il: "issait", nous: "issions", vous: "issiez", ils: "issaient" },
                    future: { je: "irai", tu: "iras", il: "ira", nous: "irons", vous: "irez", ils: "iront" }
                },
                re: {
                    present: { je: "s", tu: "s", il: "", nous: "ons", vous: "ez", ils: "ent" },
                    imperfect: { je: "ais", tu: "ais", il: "ait", nous: "ions", vous: "iez", ils: "aient" },
                    future: { je: "rai", tu: "ras", il: "ra", nous: "rons", vous: "rez", ils: "ront" }
                }
            };
            
            // D√©terminer le groupe du verbe
            let group = 'er';
            if (verb.endsWith('ir')) group = 'ir';
            else if (verb.endsWith('re')) group = 're';
            
            // Obtenir la terminaison
            const ending = endings[group] && endings[group][tense] && endings[group][tense][pronoun];
            if (!ending) return "";
            
            // Construire la forme conjugu√©e
            let stem = verb.slice(0, -group.length);
            
            // G√©rer les exceptions d'orthographe
            if (group === 'er' && ending.startsWith('e') && stem.endsWith('g')) {
                stem += 'e'; // manger -> mangeons
            }
            if (group === 'er' && ending.startsWith('o') && stem.endsWith('c')) {
                stem = stem.slice(0, -1) + '√ß'; // commencer -> commen√ßons
            }
            
            return stem + ending;
        }

        // Afficher la question
        function displayQuestion() {
            const questionElement = document.getElementById('question');
            questionElement.innerHTML = `
                Conjugue le verbe <span class="verb">${currentVerb}</span> 
                au <span class="tense">${currentTense.name}</span> 
                √† la <span class="pronoun">${currentPronoun.text} (${currentPronoun.pronoun})</span>
            `;
        }

        // Dire la question
        function speakQuestion() {
            const text = `Conjugue le verbe ${currentVerb} au ${currentTense.name} √† la ${currentPronoun.text}.`;
            speak(text);
        }

        // Synth√®se vocale
        function speak(text) {
            if (synth.speaking) {
                synth.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR';
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;
            
            // Choisir une voix f√©minine
            const voices = synth.getVoices();
            const femaleVoice = voices.find(voice => 
                voice.lang.startsWith('fr') && voice.name.toLowerCase().includes('female')
            );
            if (femaleVoice) {
                utterance.voice = femaleVoice;
            }
            
            synth.speak(utterance);
        }

        // Contr√¥le du microphone
        function toggleRecording() {
            if (!recognition) {
                alert('La reconnaissance vocale n\'est pas support√©e par votre navigateur');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            isRecording = true;
            document.getElementById('micButton').classList.add('recording');
            recognition.start();
        }

        function stopRecording() {
            isRecording = false;
            document.getElementById('micButton').classList.remove('recording');
            if (recognition) {
                recognition.stop();
            }
        }

        // V√©rifier la r√©ponse
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.toLowerCase().trim();
            
            // Nettoyer la r√©ponse (g√©rer les apostrophes)
            let cleanedAnswer = userAnswer;
            let cleanedCorrect = correctAnswer.toLowerCase();
            
            // G√©rer les apostrophes
            if (cleanedCorrect.startsWith("j'") || cleanedCorrect.startsWith("t'")) {
                if (cleanedAnswer === cleanedCorrect.replace("'", "")) {
                    cleanedAnswer = cleanedCorrect;
                }
            }
            
            if (cleanedAnswer === cleanedCorrect) {
                // Bonne r√©ponse
                score += 5;
                document.getElementById('currentScore').textContent = score;
                
                const encouragements = [
                    "Bravo ! C'est super !",
                    "Formidable ! Tu es excellent !",
                    "C'est g√©nial ! Continue comme √ßa !",
                    "Parfait ! Tu ma√Ætrises la conjugaison !"
                ];
                
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                showEncouragement(randomEncouragement, 'success');
                speak(randomEncouragement);
                
                // Passer √† la question suivante apr√®s 2 secondes
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
                
            } else {
                // Mauvaise r√©ponse
                score -= 5;
                document.getElementById('currentScore').textContent = score;
                
                speak("Erreur !");
                
                const encouragements = [
                    "Tu peux le faire ! R√©fl√©chis bien.",
                    "Allez, continue ! N'abandonne pas.",
                    "R√©fl√©chis √† la r√®gle de conjugaison.",
                    "Ce n'est pas grave, essaie encore !"
                ];
                
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                showEncouragement(randomEncouragement, 'error');
                speak(randomEncouragement);
                
                // Vider le champ pour r√©essayer
                document.getElementById('answerInput').value = '';
            }
        }

        // Afficher un message d'encouragement
        function showEncouragement(message, type) {
            const encouragementElement = document.getElementById('encouragement');
            encouragementElement.textContent = message;
            encouragementElement.className = `encouragement ${type}`;
            encouragementElement.style.display = 'block';
        }

        // Montrer la r√©ponse
        function showAnswer() {
            const answerText = `La bonne r√©ponse est : ${correctAnswer}`;
            speak(answerText);
            
            // Afficher la r√©ponse dans le champ
            document.getElementById('answerInput').value = correctAnswer;
            
            // Passer √† la question suivante apr√®s 3 secondes
            setTimeout(() => {
                nextQuestion();
            }, 3000);
        }

        // Afficher/Masquer la table de conjugaison
        function toggleConjugationTable() {
            const table = document.getElementById('conjugationTable');
            if (table.classList.contains('active')) {
                table.classList.remove('active');
            } else {
                displayConjugationTable();
                table.classList.add('active');
            }
        }

        // Afficher la table de conjugaison compl√®te
        function displayConjugationTable() {
            const content = document.getElementById('conjugationContent');
            let html = '<tr><th>Temps</th><th>Je</th><th>Tu</th><th>Il/Elle</th><th>Nous</th><th>Vous</th><th>Ils/Elles</th></tr>';
            
            const tensesToShow = tenses[currentLevel];
            tensesToShow.forEach(tense => {
                html += `<tr><td>${tense.name}</td>`;
                pronouns.forEach(pronoun => {
                    const conjugation = getConjugation(currentVerb, tense.id, pronoun.id);
                    html += `<td>${conjugation}</td>`;
                });
                html += '</tr>';
            });
            
            content.innerHTML = html;
        }

        // Retour au menu
        function backToMenu() {
            gameActive = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Sauvegarder le meilleur score
            const currentBest = parseInt(localStorage.getItem('bestScore') || '0');
            if (score > currentBest) {
                localStorage.setItem('bestScore', score);
            }
            
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.score-screen').classList.remove('active');
            document.querySelector('.menu-screen').classList.add('active');
            
            updateStats();
        }

        // Fin du jeu
        function endGame() {
            gameActive = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Sauvegarder le score
            const playerName = localStorage.getItem('playerName');
            saveScore(playerName, score);
            
            // Afficher l'√©cran des scores
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.score-screen').classList.add('active');
            
            displayScores();
        }

        // Sauvegarder le score
        function saveScore(name, score) {
            let scores = JSON.parse(localStorage.getItem('scores') || '[]');
            scores.push({ name, score, date: new Date().toISOString() });
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 10); // Garder les 10 meilleurs
            localStorage.setItem('scores', JSON.stringify(scores));
        }

        // Afficher les scores
        function displayScores() {
            const scores = JSON.parse(localStorage.getItem('scores') || '[]');
            const scoreTable = document.getElementById('scoreTable');
            
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th style="padding: 10px; border-bottom: 2px solid #ddd;">Rang</th><th style="padding: 10px; border-bottom: 2px solid #ddd;">Nom</th><th style="padding: 10px; border-bottom: 2px solid #ddd;">Score</th></tr>';
            
            scores.forEach((score, index) => {
                html += `<tr>
                    <td style="padding: 10px; text-align: center;">${index + 1}</td>
                    <td style="padding: 10px;">${score.name}</td>
                    <td style="padding: 10px; text-align: center;">${score.score}</td>
                </tr>`;
            });
            
            html += '</table>';
            scoreTable.innerHTML = html;
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            const bestScore = localStorage.getItem('bestScore') || '0';
            const lastPlayer = localStorage.getItem('lastPlayer') || '-';
            
            document.getElementById('bestScore').textContent = bestScore;
            document.getElementById('lastPlayer').textContent = lastPlayer;
            document.getElementById('totalVerbs').textContent = verbs.length;
        }

        // Gestion de la saisie clavier
        document.getElementById('answerInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });

        // Initialiser l'application
        init();
    </script>
</body>
</html>
