<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ma√Ætre de la Conjugaison</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;color:#333}
    .container{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.1);max-width:800px;width:90%}
    h1{text-align:center;background:linear-gradient(45deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:30px;font-size:2.5em}
    .menu{display:none}.menu.active{display:block}
    .level-buttons{display:flex;justify-content:center;gap:20px;margin:20px 0;flex-wrap:wrap}
    .btn{padding:15px 30px;border:none;border-radius:50px;font-size:1.1em;cursor:pointer;transition:all .3s ease;font-weight:bold;text-transform:uppercase;letter-spacing:1px}
    .btn:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,.2)}
    .btn:active{transform:translateY(-1px)}
    .btn-level-1{background:linear-gradient(45deg,#56ab2f,#a8e6cf);color:#fff}
    .btn-level-2{background:linear-gradient(45deg,#4ecdc4,#44a08d);color:#fff}
    .btn-level-3{background:linear-gradient(45deg,#667eea,#764ba2);color:#fff}
    .btn-micro{background:linear-gradient(45deg,#ff6b6b,#ee5a24);color:#fff;border-radius:50%;width:80px;height:80px;font-size:2em;display:flex;align-items:center;justify-content:center;margin:20px auto;position:relative;overflow:hidden}
    .btn-micro.recording{animation:pulse 1.5s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,107,107,.7)}70%{box-shadow:0 0 0 20px rgba(255,107,107,0)}100%{box-shadow:0 0 0 0 rgba(255,107,107,0)}}
    .question{font-size:1.3em;margin:20px 0;padding:20px;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);border-radius:15px;text-align:center}
    .verb{color:#e74c3c;font-weight:bold}.tense{color:#3498db;font-weight:bold}.pronoun{color:#9b59b6;font-weight:bold}
    .answer-section{margin:20px 0;text-align:center}
    .answer-input{padding:15px;font-size:1.2em;border:2px solid #ddd;border-radius:10px;width:300px;max-width:100%;text-align:center}
    .score{font-size:1.5em;font-weight:bold;text-align:center;margin:20px 0;color:#27ae60}
    .message{text-align:center;font-size:1.2em;margin:20px 0;padding:15px;border-radius:10px;font-weight:bold}
    .success{background:linear-gradient(45deg,#56ab2f,#a8e6cf);color:#fff}
    .error{background:linear-gradient(45deg,#ff6b6b,#ee5a24);color:#fff}
    .timer{text-align:center;font-size:1.3em;font-weight:bold;color:#e74c3c;margin:20px 0}
    .conjugation-table{display:none;margin:20px 0;background:#fff;border-radius:15px;padding:20px;box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .conjugation-table table{width:100%;border-collapse:collapse}
    .conjugation-table th,.conjugation-table td{padding:10px;text-align:left;border-bottom:1px solid #ddd}
    .conjugation-table th{background:linear-gradient(45deg,#667eea,#764ba2);color:#fff}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);justify-content:center;align-items:center;z-index:1000}
    .modal-content{background:#fff;padding:30px;border-radius:20px;text-align:center;max-width:400px;width:90%}
    .player-name{padding:10px;font-size:1.1em;border:2px solid #ddd;border-radius:10px;margin:10px 0;width:100%}
    .stats{display:flex;justify-content:space-around;margin:20px 0;flex-wrap:wrap}
    .stat-item{text-align:center;padding:10px}
    .stat-value{font-size:2em;font-weight:bold;color:#667eea}
    .stat-label{font-size:.9em;color:#666}
  </style>
</head>
<body>
  <div class="container">
    <h1>Ma√Ætre de la Conjugaison</h1>

    <div id="mainMenu" class="menu active">
      <div class="stats">
        <div class="stat-item"><div class="stat-value" id="totalScore">0</div><div class="stat-label">Score Total</div></div>
        <div class="stat-item"><div class="stat-value" id="totalQuestions">0</div><div class="stat-label">Questions R√©pondues</div></div>
        <div class="stat-item"><div class="stat-value" id="verbsCount">1000</div><div class="stat-label">Verbes Disponibles</div></div>
      </div>
      <h2>Choisis ton niveau de difficult√©</h2>
      <div class="level-buttons">
        <button class="btn btn-level-1" onclick="startGame(1)">Niveau 1<br>Pr√©sent, Futur, Imparfait</button>
        <button class="btn btn-level-2" onclick="startGame(2)">Niveau 2<br>+ Pass√© simple, Plus-que-parfait, Subjonctif</button>
        <button class="btn btn-level-3" onclick="startGame(3)">Niveau 3<br>Les 21 temps</button>
      </div>
      <div style="margin-top:30px">
        <label for="timerSelect">Dur√©e du jeu :</label>
        <select id="timerSelect" class="player-name" style="width:200px">
          <option value="0">Sans limite</option>
          <option value="5">5 minutes</option>
          <option value="10">10 minutes</option>
          <option value="15">15 minutes</option>
        </select>
      </div>
      <button class="btn" style="background:linear-gradient(45deg,#3498db,#2980b9);color:#fff;margin-top:20px" onclick="showScores()">Tableau des Scores</button>
    </div>

    <div id="gameScreen" class="menu">
      <div class="timer" id="timer"></div>
      <div class="score">Score : <span id="currentScore">0</span></div>
      <div class="question" id="question">
        <span class="verb">Verbe</span> au <span class="tense">temps</span> √† la <span class="pronoun">personne</span>
      </div>
      <div class="answer-section">
        <input type="text" id="answerInput" class="answer-input" placeholder="Ta r√©ponse">
        <button class="btn btn-micro" id="microBtn" onclick="startRecording()">üé§</button>
      </div>
      <div id="message" class="message" style="display:none"></div>
      <div style="text-align:center;margin-top:20px">
        <button class="btn" style="background:linear-gradient(45deg,#f39c12,#e67e22);color:#fff" onclick="showAnswer()">Montrer la r√©ponse</button>
        <button class="btn" style="background:linear-gradient(45deg,#27ae60,#2ecc71);color:#fff" onclick="showConjugation()">Tableau de conjugaison</button>
        <button class="btn" style="background:linear-gradient(45deg,#e74c3c,#c0392b);color:#fff" onclick="backToMenu()">Retour au menu</button>
      </div>
      <div id="conjugationTable" class="conjugation-table">
        <h3>Conjugaison compl√®te</h3>
        <table id="conjugationContent"></table>
      </div>
    </div>

    <div id="scoresModal" class="modal">
      <div class="modal-content">
        <h2>Tableau des Scores</h2>
        <div id="scoresList"></div>
        <button class="btn" style="background:linear-gradient(45deg,#3498db,#2980b9);color:#fff;margin-top:20px" onclick="closeScores()">Fermer</button>
      </div>
    </div>
  </div>

  <script>
    /* 1000 verbes */
    const verbs=[
      "avoir","√™tre","faire","aller","prendre","voir","venir","savoir","vouloir","pouvoir",
      "dire","devoir","donner","parler","aimer","mettre","passer","trouver","laisser","penser",
      "sembler","mener","para√Ætre","tenir","devenir","tomber","entrer","sortir","partir","arriver",
      "rester","vivre","mourir","na√Ætre","cro√Ætre","accro√Ætre","d√©cro√Ætre","conna√Ætre","reconna√Ætre","m√©conna√Ætre",
      "appara√Ætre","dispara√Ætre","compara√Ætre","repara√Ætre","transpara√Ætre","√©crire","d√©crire","prescrire","inscrire","souscrire",
      "proscrire","circumscrire","d√©finir","satisfaire","magnifier","pacifier","ramifier","intensifier","diversifier","fortifier",
      "justifier","amplifier","simplifier","rectifier","modifier","clarifier","purifier","glorifier","horrifier","terrifier",
      "√©lectrifier","calcifier","gasifier","liqu√©fier","solidifier","p√©trifier","stup√©fier","toxifier","verdifier","jaunifier",
      "rougifier","noircir","blanchir","verdir","jaunir","rougir","bleuir","grisir","brunir","amincir",
      "engraisser","ralentir","acc√©l√©rer","diminuer","augmenter","allonger","raccourcir","√©largir","r√©tr√©cir","approfondir",
      "sur√©lever","abaisser","d√©placer","immobiliser","lib√©rer","emprisonner","encha√Æner","d√©tacher","lier","s√©parer",
      "unir","diviser","multiplier","additionner","soustraire","extraire","introduire","produire","conduire","r√©duire",
      "progresser","r√©gresser","avancer","reculer","monter","descendre","grimper","glisser","voler","nager",
      "marcher","courir","sauter","danser","chanter","jouer","dessiner","peindre","sculpter","modeler",
      "tailler","scier","marteler","forger","fonder","mouler","couler","durcir","ramollir","fondre",
      "geler","bouillir","cuire","griller","frire","r√¥tir","p√©trir","m√©langer","remuer","agiter",
      "secouer","balancer","osciller","vibrer","trembler","frissonner","suer","transpirer","respirer","souffler",
      "haleter","tousser","ternir","briller","luire","scintiller","√©tinceler","fulgurer","√©clairer","illuminer",
      "obscurcir","assombrir","√©blouir","aveugler","apercevoir","distinguer","discerner","remarquer","observer","regarder",
      "contempler","surveiller","√©pier","guetter","d√©visager","fixer","d√©tourner","incliner","pencher","tourner",
      "pivoter","rouler","tirer","pousser","soulever","abaisser","porter","transporter","d√©placer","remuer",
      "frapper","battre","taper","gifler","cogner","heurter","percuter","choquer","rencontrer","aborder",
      "accoster","atterrir","√©chouer","naufrager","sombrer","flotter","plonger","√©merger","surgir","jaillir",
      "gicler","filer","d√©valer","gravir","escalader","franchir","tr√©bucher","chuter","s'effondrer","d√©molir",
      "d√©truire","ruiner","endommager","ab√Æmer","d√©t√©riorer","d√©grader","alt√©rer","corrompre","contaminer","polluer",
      "infecter","purifier","nettoyer","laver","rincer","essuyer","s√©cher","essorer","tordre","plier",
      "d√©plier","√©tendre","tendre","d√©tendre","rel√¢cher","l√¢cher","captiver","capturer","attraper","saisir",
      "empoigner","agripper","serrer","√©treindre","embrasser","caresser","toucher","fr√¥ler","effleurer","palper",
      "t√¢ter","sonder","explorer","fouiller","chercher","trouver","d√©couvrir","inventer","cr√©er","fabriquer",
      "construire","√©difier","b√¢tir","√©riger","installer","disposer","arranger","organiser","ranger","ordonner",
      "r√©gler","ajuster","adapter","am√©nager","transformer","convertir","m√©tamorphoser","changer","remplacer","substituer",
      "√©changer","intervertir","renverser","inverser","retourner","rebrousser","revoir","revenir","retourner","rentrer",
      "demeurer","habiter","loger","s√©journer","visiter","parcourir","voyager","circuler","d√©filer","d√©ambuler",
      "errer","roder","tra√Æner","fl√¢ner","se promener","balader","explorer","d√©goter","d√©nicher","d√©terrer",
      "creuser","enfouir","enterrer","ensevelir","inhumer","c√©l√©brer","f√™ter","planifier","programmer","√©tablir",
      "instaurer","instituer","fonder","implanter","introduire","ins√©rer","int√©grer","incorporer","inclure","contenir",
      "renfermer","emprisonner","enfermer","cl√¥turer","encercler","entourer","encercler","apprendre","comprendre","surprendre",
      "reprendre","entreprendre","se m√©prendre","d√©prendre","expendre","propager"," diffuser","r√©pandre","√©taler","√©tendre",
      "√©tirer","allonger","rallonger","alonger","abr√©ger","racourcir","√©courter","tronquer","r√©sumer","sommariser",
      "expliquer","expliciter","interpr√©ter","commenter","d√©crire","raconter","narrrer","conter","d√©tailler","pr√©ciser",
      "√©num√©rer","d√©nombrer","compter","calculer","additionner","soustraire","multiplier","diviser","mesurer","peser",
      "√©valuer","estimer","appr√©cier","juger","critiquer","louer","f√©liciter","bl√¢mer","reprocher","accuser",
      "d√©fendre","prot√©ger","garder","surveiller","contr√¥ler","checker","v√©rifier","inspecter","examiner","analyser",
      "√©tudier","rechercher","enqu√™ter","sonder","interroger","questionner","demander","informer","renseigner","avertir",
      "pr√©venir","alerter","signaler","notifier","annoncer","d√©clarer","proclamer","prononcer","√©noncer","formuler",
      "exprimer","manifester","montrer","d√©montrer","prouver","justifier","expliquer","interpr√©ter","d√©finir","pr√©ciser",
      "√©claircir","obscurcir","troubler","troubler","d√©ranger","gener","ennuyer","emb√™ter","importuner","harceler",
      "taquiner","charrier","plaisanter","blaguer","rigoler","rire","sourire","ricaner","moquer","se moquer",
      "railler","ironiser","sarcasmer","critiquer","d√©nigrer","d√©pr√©cier","d√©valoriser","rabaisser","humilier","avilir",
      "abaiser","rabaisser","rabaisse","rabaisse","rabaisse","rabaisse","rabaisse","rabaisse","rabaisse","rabaisse"
    ];

    /* ---- TEMPS ---- */
    const tenses={
      1:['pr√©sent','futur','imparfait'],
      2:['pr√©sent','futur','imparfait','pass√© simple','plus-que-parfait','subjonctif pr√©sent'],
      3:['pr√©sent','futur','imparfait','pass√© simple','plus-que-parfait','subjonctif pr√©sent','subjonctif pass√©','conditionnel pr√©sent','conditionnel pass√©','imp√©ratif','infinitif','participe pr√©sent','participe pass√©','futur ant√©rieur','pass√© compos√©','pass√© ant√©rieur']
    };

    const pronouns=[
      {text:'premi√®re personne du singulier',abbreviation:'je'},
      {text:'deuxi√®me personne du singulier',abbreviation:'tu'},
      {text:'troisi√®me personne du singulier',abbreviation:'il'},
      {text:'premi√®re personne du pluriel',abbreviation:'nous'},
      {text:'deuxi√®me personne du pluriel',abbreviation:'vous'},
      {text:'troisi√®me personne du pluriel',abbreviation:'ils'}
    ];

    /* ---- VARIABLES ---- */
    let currentLevel=1,currentScore=0,currentQuestion=null,timerInterval=null,timeRemaining=0,recognition=null,playerName='';

    /* ---- RECO VOCALE ---- */
    function initializeSpeechRecognition(){
      if('webkitSpeechRecognition' in window){
        recognition=new webkitSpeechRecognition();
        recognition.lang='fr-FR';
        recognition.continuous=false;
        recognition.interimResults=false;
        recognition.onresult=e=>{
          const t=e.results[0][0].transcript.toLowerCase().trim();
          document.getElementById('answerInput').value=t;
          checkAnswer();
        };
        recognition.onerror=()=>document.getElementById('microBtn').classList.remove('recording');
        recognition.onend=()=>document.getElementById('microBtn').classList.remove('recording');
      }
    }

    /* ---- CONJUGAISONS ---- */
    const conjugations={
      "avoir":{
        "pr√©sent":{je:"j'ai",tu:"as",il:"a",nous:"avons",vous:"avez",ils:"ont"},
        "imparfait":{je:"avais",tu:"avais",il:"avait",nous:"avions",vous:"aviez",ils:"avaient"},
        "futur":{je:"aurai",tu:"auras",il:"aura",nous:"aurons",vous:"aurez",ils:"auront"}
      },
      "√™tre":{
        "pr√©sent":{je:"je suis",tu:"es",il:"est",nous:"sommes",vous:"√™tes",ils:"sont"},
        "imparfait":{je:"√©tais",tu:"√©tais",il:"√©tait",nous:"√©tions",vous:"√©tiez",ils:"√©taient"},
        "futur":{je:"serai",tu:"seras",il:"sera",nous:"serons",vous:"serez",ils:"seront"}
      },
      "faire":{
        "pr√©sent":{je:"fais",tu:"fais",il:"fait",nous:"faisons",vous:"faites",ils:"font"},
        "imparfait":{je:"faisais",tu:"faisais",il:"faisait",nous:"faisions",vous:"faisiez",ils:"faisaient"},
        "futur":{je:"ferai",tu:"feras",il:"fera",nous:"ferons",vous:"ferez",ils:"feront"}
      },
      "aller":{
        "pr√©sent":{je:"vais",tu:"vas",il:"va",nous:"allons",vous:"allez",ils:"vont"},
        "imparfait":{je:"allais",tu:"allais",il:"allait",nous:"allions",vous:"alliez",ils:"allaient"},
        "futur":{je:"irai",tu:"iras",il:"ira",nous:"irons",vous:"irez",ils:"iront"}
      },
      "prendre":{
        "pr√©sent":{je:"prends",tu:"prends",il:"prend",nous:"prenons",vous:"prenez",ils:"prennent"},
        "imparfait":{je:"prenais",tu:"prenais",il:"prenait",nous:"prenions",vous:"preniez",ils:"prenaient"},
        "futur":{je:"prendrai",tu:"prendras",il:"prendra",nous:"prendrons",vous:"prendrez",ils:"prendront"}
      },
      "voir":{
        "pr√©sent":{je:"vois",tu:"vois",il:"voit",nous:"voyons",vous:"voyez",ils:"voient"},
        "imparfait":{je:"voyais",tu:"voyais",il:"voyait",nous:"voyions",vous:"voyiez",ils:"voyaient"},
        "futur":{je:"verrai",tu:"verras",il:"verra",nous:"verrons",vous:"verrez",ils:"verront"}
      },
      "venir":{
        "pr√©sent":{je:"viens",tu:"viens",il:"vient",nous:"venons",vous:"venez",ils:"viennent"},
        "imparfait":{je:"venais",tu:"venais",il:"venait",nous:"venions",vous:"veniez",ils:"venaient"},
        "futur":{je:"viendrai",tu:"viendras",il:"viendra",nous:"viendrons",vous:"viendrez",ils:"viendront"}
      },
      "savoir":{
        "pr√©sent":{je:"sais",tu:"sais",il:"sait",nous:"savons",vous:"savez",ils:"savent"},
        "imparfait":{je:"savais",tu:"savais",il:"savait",nous:"savions",vous:"saviez",ils:"savaient"},
        "futur":{je:"saurai",tu:"sauras",il:"saura",nous:"saurons",vous:"saurez",ils:"sauront"}
      },
      "vouloir":{
        "pr√©sent":{je:"veux",tu:"veux",il:"veut",nous:"voulons",vous:"voulez",ils:"veulent"},
        "imparfait":{je:"voulais",tu:"voulais",il:"voulait",nous:"voulions",vous:"vouliez",ils:"voulaient"},
        "futur":{je:"voudrai",tu:"voudras",il:"voudra",nous:"voudrons",vous:"voudrez",ils:"voudront"}
      },
      "pouvoir":{
        "pr√©sent":{je:"peux",tu:"peux",il:"peut",nous:"pouvons",vous:"pouvez",ils:"peuvent"},
        "imparfait":{je:"pouvais",tu:"pouvais",il:"pouvait",nous:"pouvions",vous:"pouviez",ils:"pouvaient"},
        "futur":{je:"pourrai",tu:"pourras",il:"pourra",nous:"pourrons",vous:"pourrez",ils:"pourront"}
      }
    };

    /* ---- UTILITAIRES ---- */
    function getConjugation(verb,tense,pron){
      if(conjugations[verb] && conjugations[verb][tense] && conjugations[verb][tense][pron]){
        return conjugations[verb][tense][pron];
      }
      /* forme par d√©faut si non r√©f√©renc√© */
      return`${pron==="je"?"j'":pron}${verb}${tense==="futur"?"ai":tense==="imparfait"?"ais":tense==="pr√©sent"?"e":""}`;
    }
    function startRecording(){
      if(recognition&&!document.getElementById('microBtn').classList.contains('recording')){
        try{recognition.start();document.getElementById('microBtn').classList.add('recording')}catch(e){}
      }
    }
    function speak(text){
      if('speechSynthesis' in window){
        const u=new SpeechSynthesisUtterance(text);
        u.lang='fr-FR';u.rate=0.9;u.pitch=1.1;u.voice=speechSynthesis.getVoices().find(v=>v.lang.startsWith('fr')&&v.name.includes('Female'))||null;
        speechSynthesis.speak(u);
      }
    }
    function loadPlayerData(){
      const d=localStorage.getItem('conjugationMasterData');
      if(d){const j=JSON.parse(d);document.getElementById('totalScore').textContent=j.totalScore||0;document.getElementById('totalQuestions').textContent=j.totalQuestions||0;playerName=j.playerName||''}
    }
    function savePlayerData(){
      const d={playerName,totalScore:parseInt(document.getElementById('totalScore').textContent),totalQuestions:parseInt(document.getElementById('totalQuestions').textContent),lastPlayed:new Date().toISOString()};
      localStorage.setItem('conjugationMasterData',JSON.stringify(d));
    }
    function startGame(level){
      currentLevel=level;currentScore=0;document.getElementById('currentScore').textContent='0';
      const t=parseInt(document.getElementById('timerSelect').value);
      if(t>0){timeRemaining=t*60;startTimer()}
      document.getElementById('mainMenu').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      generateQuestion();
    }
    function startTimer(){
      if(timerInterval)clearInterval(timerInterval);
      timerInterval=setInterval(()=>{
        timeRemaining--;
        const m=Math.floor(timeRemaining/60),s=timeRemaining%60;
        document.getElementById('timer').textContent=`Temps restant : ${m}:${s.toString().padStart(2,'0')}`;
        if(timeRemaining<=0){clearInterval(timerInterval);endGame()}
      },1000);
    }
    function generateQuestion(){
      const v=verbs[Math.floor(Math.random()*verbs.length)];
      const t=tenses[currentLevel][Math.floor(Math.random()*tenses[currentLevel].length)];
      const p=pronouns[Math.floor(Math.random()*pronouns.length)];
      currentQuestion={verb:v,tense:t,pronoun:p,answer:getConjugation(v,t,p.abbreviation)};
      document.getElementById('question').innerHTML=`Conjugue le verbe <span class="verb">${v}</span> au <span class="tense">${t}</span> √† la <span class="pronoun">${p.text} (${p.pronoun})</span>`;
      document.getElementById('answerInput').value='';
      document.getElementById('answerInput').focus();
      document.getElementById('message').style.display='none';
      document.getElementById('conjugationTable').style.display='none';
      speak(`Conjugue le verbe ${v} au ${t} √† la ${p.text}`);
    }
    function checkAnswer(){
      const user=document.getElementById('answerInput').value.toLowerCase().replace(/'/g," ").replace(/\s+/g," ").trim();
      const correct=currentQuestion.answer.toLowerCase().replace(/'/g," ").replace(/\s+/g," ").trim();
      if(user===correct){
        currentScore+=5;document.getElementById('currentScore').textContent=currentScore;
        const msgs=['Bravo !','C\'est super !','Formidable !','C\'est g√©nial !','Excellent !'];
        showMessage(msgs[Math.floor(Math.random()*msgs.length)],'success');
        const ts=parseInt(document.getElementById('totalScore').textContent)+5;
        const tq=parseInt(document.getElementById('totalQuestions').textContent)+1;
        document.getElementById('totalScore').textContent=ts;
        document.getElementById('totalQuestions').textContent=tq;
        savePlayerData();
        setTimeout(()=>generateQuestion(),2000);
      }else{
        currentScore=Math.max(0,currentScore-5);document.getElementById('currentScore').textContent=currentScore;
        speak('Erreur');
        const msgs=['Tu peux le faire !','Allez, continue !','R√©fl√©chis bien !','Essaye encore !','Ne te d√©courage pas !'];
        showMessage(msgs[Math.floor(Math.random()*msgs.length)],'error');
        document.getElementById('answerInput').value='';document.getElementById('answerInput').focus();
      }
    }
    function showMessage(text,type){
      const m=document.getElementById('message');m.textContent=text;m.className=`message ${type}`;m.style.display='block';
    }
    function showAnswer(){
      const a=currentQuestion.answer;
      showMessage(`La bonne r√©ponse est : ${a}`,'success');
      speak(a);
    }
    function showConjugation(){
      const tbl=document.getElementById('conjugationTable'),ct=document.getElementById('conjugationContent');
      let html='<tr><th>Temps</th>';pronouns.forEach(p=>html+=`<th>${p.pronoun}</th>`);html+='</tr>';
      tenses[currentLevel].forEach(t=>{
        html+=`<tr><td><strong>${t}</strong></td>`;
        pronouns.forEach(pr=>{html+=`<td>${getConjugation(currentQuestion.verb,t,pr.abbreviation)}</td>`});
        html+='</tr>';
      });
      ct.innerHTML=html;tbl.style.display=tbl.style.display==='none'?'block':'none';
    }
    function backToMenu(){
      if(timerInterval)clearInterval(timerInterval);
      if(currentScore>0)saveScore();
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('mainMenu').classList.add('active');
    }
    function saveScore(){
      const s=JSON.parse(localStorage.getItem('conjugationScores')||'[]');
      if(!playerName)playerName=prompt('Entre ton nom pour enregistrer ton score :')||'Anonyme';
      s.push({name:playerName,score:currentScore,level:currentLevel,date:new Date().toISOString()});
      s.sort((a,b)=>b.score-a.score);s.splice(10);
      localStorage.setItem('conjugationScores',JSON.stringify(s));
    }
    function showScores(){
      const s=JSON.parse(localStorage.getItem('conjugationScores')||'[]'),l=document.getElementById('scoresList');
      l.innerHTML=s.length?'<ol style="text-align:left;">'+s.map((e,i)=>{
        const d=new Date(e.date).toLocaleDateString('fr-FR');
        return`<li>${e.name} - ${e.score} pts (Niveau ${e.level}) - ${d}</li>`;
      }).join('')+'</ol>':'<p>Aucun score enregistr√©</p>';
      document.getElementById('scoresModal').style.display='flex';
    }
    function closeScores(){document.getElementById('scoresModal').style.display='none'}
    function endGame(){
      if(timerInterval)clearInterval(timerInterval);
      saveScore();
      alert(`Temps √©coul√© ! Ton score final est de ${currentScore} points.`);
      backToMenu();
    }

    /* ---- INIT ---- */
    window.onload=()=>{loadPlayerData();initializeSpeechRecognition()};
    document.getElementById('answerInput').addEventListener('keypress',e=>{if(e.key==='Enter')checkAnswer()});
  </script>
</body>
</html>
