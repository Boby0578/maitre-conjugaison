<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MaÃ®tre de la Conjugaison</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      max-width: 700px;
      width: 90%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    .btn {
      background: linear-gradient(45deg, #f093fb, #f5576c);
      border: none;
      color: white;
      padding: 12px 25px;
      margin: 10px;
      border-radius: 30px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: scale(1.05);
    }

    .hidden {
      display: none;
    }

    input[type="text"] {
      padding: 10px;
      border-radius: 20px;
      border: none;
      width: 80%;
      margin-top: 10px;
      font-size: 1em;
    }

    .message {
      margin-top: 15px;
      font-weight: bold;
    }

    .success {
      color: #a8ff78;
    }

    .error {
      color: #ff6b6b;
    }

    .score {
      font-size: 1.2em;
      margin-top: 10px;
    }

    .timer {
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    #microBtn {
      background: linear-gradient(45deg, #43e97b, #38f9d7);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5em;
    }

    .level-selection, .timer-selection {
      margin: 15px 0;
    }

    .verb { color: #ff9a9e; }
    .tense { color: #a1c4fd; }
    .pronoun { color: #d4fc79; }

    #conjugationTable {
      margin-top: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      color: white;
      border-collapse: collapse;
    }

    th, td {
      padding: 5px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¯ MaÃ®tre de la Conjugaison</h1>

    <div id="mainMenu">
      <h2>Bienvenue dans le jeu de conjugaison franÃ§aise!</h2>
      <div class="level-selection">
        <button class="btn" onclick="selectLevel(1)">Niveau 1</button>
        <button class="btn" onclick="selectLevel(2)">Niveau 2</button>
        <button class="btn" onclick="selectLevel(3)">Niveau 3</button>
      </div>
      <div class="timer-selection">
        <button class="btn" onclick="selectTimer(15)">15 min</button>
        <button class="btn" onclick="selectTimer(10)">10 min</button>
        <button class="btn" onclick="selectTimer(5)">5 min</button>
      </div>
      <input type="text" id="playerName" placeholder="Votre nom" />
      <br />
      <button class="btn" onclick="startGame()">ðŸŽ® Commencer</button>
      <div class="score" id="scoresList"></div>
    </div>

    <div id="gameArea" class="hidden">
      <div class="timer" id="timer">Temps: 15:00</div>
      <div class="score">Score: <span id="currentScore">0</span></div>
      <div class="question" id="question"></div>
      <input type="text" id="answerInput" placeholder="Votre rÃ©ponse" onkeypress="if(event.key === 'Enter') checkAnswer()" />
      <br />
      <button class="btn" onclick="checkAnswer()">Valider</button>
      <button class="btn" id="microBtn" onclick="startRecognition()">ðŸŽ¤</button>
      <div id="message" class="message hidden"></div>
      <br />
      <button class="btn" onclick="showAnswer()">Voir la rÃ©ponse</button>
      <button class="btn" onclick="toggleConjugationTable()">Table de conjugaison</button>
      <button class="btn" onclick="backToMenu()">Retour au menu</button>
      <div id="conjugationTable" class="hidden"></div>
    </div>
  </div>

  <script>
    const verbs = [
      "aimer", "parler", "manger", "chanter", "danser", "travailler", "Ã©tudier", "jouer", "regarder", "Ã©couter",
      "finir", "choisir", "obÃ©ir", "rÃ©ussir", "grossir", "maigrir", "vieillir", "rougir", "pÃ¢lir", "dormir",
      "partir", "sortir", "servir", "cueillir", "ouvrir", "offrir", "souffrir", "couvrir", "dÃ©couvrir", "tenir",
      "venir", "devenir", "revenir", "parvenir", "convenir", "intervenir", "prÃ©venir", "provenir", "survenir", "appartenir",
      "Ãªtre", "avoir", "aller", "faire", "prendre", "mettre", "voir", "boire", "croire", "vivre",
      "naÃ®tre", "mourir", "lire", "Ã©crire", "dire", "conduire", "construire", "cuire", "dÃ©truire", "instruire"
    ];

    const tenses = {
      1: ["prÃ©sent", "futur", "imparfait"],
      2: ["prÃ©sent", "futur", "imparfait", "passÃ© simple", "plus-que-parfait", "subjonctif prÃ©sent"],
      3: ["prÃ©sent", "futur", "imparfait", "passÃ© simple", "plus-que-parfait", "subjonctif prÃ©sent", "conditionnel prÃ©sent"]
    };

    const pronouns = [
      { text: "premiÃ¨re personne du singulier", pronoun: "je", person: "1s" },
      { text: "deuxiÃ¨me personne du singulier", pronoun: "tu", person: "2s" },
      { text: "troisiÃ¨me personne du singulier", pronoun: "il", person: "3s" },
      { text: "premiÃ¨re personne du pluriel", pronoun: "nous", person: "1p" },
      { text: "deuxiÃ¨me personne du pluriel", pronoun: "vous", person: "2p" },
      { text: "troisiÃ¨me personne du pluriel", pronoun: "ils", person: "3p" }
    ];

    let currentLevel = 1;
    let currentTimer = 15;
    let currentScore = 0;
    let currentVerb = "";
    let currentTense = "";
    let currentPronoun = "";
    let correctAnswer = "";
    let timeRemaining;
    let timerInterval;
    let playerName = "";
    let isGameActive = false;
    let recognition;

    const irregular = {
      Ãªtre: {
        prÃ©sent: ["suis", "es", "est", "sommes", "Ãªtes", "sont"],
        imparfait: ["Ã©tais", "Ã©tais", "Ã©tait", "Ã©tions", "Ã©tiez", "Ã©taient"],
        futur: ["serai", "seras", "sera", "serons", "serez", "seront"]
      },
      avoir: {
        prÃ©sent: ["ai", "as", "a", "avons", "avez", "ont"],
        imparfait: ["avais", "avais", "avait", "avions", "aviez", "avaient"],
        futur: ["aurai", "auras", "aura", "aurons", "aurez", "auront"]
      },
      aller: {
        prÃ©sent: ["vais", "vas", "va", "allons", "allez", "vont"],
        futur: ["irai", "iras", "ira", "irons", "irez", "iront"]
      },
      faire: {
        prÃ©sent: ["fais", "fais", "fait", "faisons", "faites", "font"],
        futur: ["ferai", "feras", "fera", "ferons", "ferez", "feront"]
      },
      prendre: {
        prÃ©sent: ["prends", "prends", "prend", "prenons", "prenez", "prennent"],
        futur: ["prendrai", "prendras", "prendra", "prendrons", "prendrez", "prendront"]
      }
    };

    function selectLevel(level) {
      currentLevel = level;
    }

    function selectTimer(minutes) {
      currentTimer = minutes;
    }

    function startGame() {
      playerName = document.getElementById('playerName').value.trim() || "Joueur";
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('gameArea').classList.remove('hidden');
      currentScore = 0;
      isGameActive = true;
      updateScore();
      startTimer();
      generateQuestion();
      speak("CommenÃ§ons!");
    }

    function backToMenu() {
      clearInterval(timerInterval);
      isGameActive = false;
      document.getElementById('gameArea').classList.add('hidden');
      document.getElementById('mainMenu').classList.remove('hidden');
    }

    function startTimer() {
      timeRemaining = currentTimer * 60;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 0) endGame();
      }, 1000);
    }

    function updateTimerDisplay() {
      const min = Math.floor(timeRemaining / 60);
      const sec = timeRemaining % 60;
      document.getElementById('timer').textContent = `Temps: ${min}:${sec.toString().padStart(2, '0')}`;
    }

    function generateQuestion() {
      if (!isGameActive) return;
      currentVerb = verbs[Math.floor(Math.random() * verbs.length)];
      currentTense = tenses[currentLevel][Math.floor(Math.random() * tenses[currentLevel].length)];
      currentPronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
      correctAnswer = getConjugation(currentVerb, currentTense, currentPronoun.person);
      document.getElementById('question').innerHTML =
        `Conjugue le verbe <span class="verb">${currentVerb}</span> au <span class="tense">${currentTense}</span> Ã  la <span class="pronoun">${currentPronoun.text} (${currentPronoun.pronoun})</span>`;
      document.getElementById('answerInput').value = '';
      document.getElementById('answerInput').focus();
      speak(`Conjugue ${currentVerb} au ${currentTense} Ã  la ${currentPronoun.text}`);
    }

    function getConjugation(verb, tense, person) {
      const idx = { "1s": 0, "2s": 1, "3s": 2, "1p": 3, "2p": 4, "3p": 5 }[person];
      if (irregular[verb] && irregular[verb][tense]) return irregular[verb][tense][idx];
      const base = verb.slice(0, -2);
      if (verb.endsWith("er") && tense === "prÃ©sent") {
        const endings = ["e", "es", "e", "ons", "ez", "ent"];
        return person === "1s" ? `j${startsWithVowel(endings[idx]) ? "'" : "e "}${base}${endings[idx]}` : base + endings[idx];
      }
      return verb;
    }

    function startsWithVowel(word) {
      return /^[aeÃ©Ã¨ÃªiÃ®oÃ´uÃ»]/i.test(word);
    }

    function checkAnswer() {
      const user = document.getElementById('answerInput').value.toLowerCase().trim();
      const correct = correctAnswer.toLowerCase().trim();
      if (user === correct || user === correct.replace("j'", "je ")) {
        currentScore += 5;
        updateScore();
        showMessage("Bravo!", "success");
        speak("Bravo!");
        setTimeout(generateQuestion, 1500);
      } else {
        currentScore = Math.max(0, currentScore - 5);
        updateScore();
        speak("Erreur");
        showMessage("Erreur. RÃ©essaie!", "error");
        document.getElementById('answerInput').value = '';
      }
    }

    function showAnswer() {
      document.getElementById('answerInput').value = correctAnswer;
      speak(correctAnswer);
    }

    function toggleConjugationTable() {
      const div = document.getElementById('conjugationTable');
      div.classList.toggle('hidden');
      if (!div.classList.contains('hidden')) {
        div.innerHTML = `<h3>Conjugaison de ${currentVerb}</h3>`;
        const table = document.createElement('table');
        const header = document.createElement('tr');
        header.innerHTML = '<th>Temps</th><th>Je</th><th>Tu</th><th>Il</th><th>Nous</th><th>Vous</th><th>Ils</th>';
        table.appendChild(header);
        tenses[currentLevel].forEach(tense => {
          const row = document.createElement('tr');
          row.innerHTML = `<td>${tense}</td>` +
            pronouns.map(p => `<td>${getConjugation(currentVerb, tense, p.person)}</td>`).join('');
          table.appendChild(row);
        });
        div.appendChild(table);
      }
    }

    function showMessage(msg, type) {
      const m = document.getElementById('message');
      m.textContent = msg;
      m.className = "message " + type;
      m.classList.remove('hidden');
      setTimeout(() => m.classList.add('hidden'), 2000);
    }

    function updateScore() {
      document.getElementById('currentScore').textContent = currentScore;
    }

    function speak(text) {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'fr-FR';
        speechSynthesis.speak(utter);
      }
    }

    function startRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Reconnaissance vocale non supportÃ©e sur ce navigateur.");
        return;
      }
      const rec = new webkitSpeechRecognition();
      rec.lang = 'fr-FR';
      rec.onresult = function (e) {
        document.getElementById('answerInput').value = e.results[0][0].transcript;
        checkAnswer();
      };
      rec.start();
    }

    function endGame() {
      clearInterval(timerInterval);
      isGameActive = false;
      speak("Fin du jeu!");
      alert(`Fin du jeu ! Ton score est de ${currentScore} points.`);
      backToMenu();
    }

    window.onload = () => {
      document.getElementById('playerName').focus();
    };
  </script>
</body>
</html>
