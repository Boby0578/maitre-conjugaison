<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma√Ætre de la Conjugaison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
            text-align: center;
        }

        h1 {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5em;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .menu {
            display: none;
        }

        .menu.active {
            display: block;
        }

        .level-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }

        .btn-micro {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 2em;
            margin: 20px auto;
            display: block;
        }

        .question {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            color: #333;
        }

        .verb { color: #e74c3c; }
        .tense { color: #3498db; }
        .pronoun { color: #27ae60; }

        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .score-display {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 20px 0;
        }

        .message {
            font-size: 1.2em;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .hidden {
            display: none;
        }

        .timer-select {
            margin: 20px 0;
        }

        .timer-select select {
            padding: 10px;
            font-size: 1.1em;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        #conjTable {
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }

        th {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .name-input {
            margin: 20px 0;
        }

        .name-input input {
            padding: 10px;
            font-size: 1.1em;
            border-radius: 5px;
            border: 2px solid #ddd;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ma√Ætre de la Conjugaison</h1>
        
        <div id="startMenu" class="menu active">
            <div class="name-input">
                <input type="text" id="playerName" placeholder="Entrez votre nom">
                <button class="btn" onclick="saveName()">Enregistrer</button>
            </div>
            <div class="timer-select">
                <label>Choisir le temps: </label>
                <select id="timerSelect">
                    <option value="0">Sans limite</option>
                    <option value="15">15 minutes</option>
                    <option value="10">10 minutes</option>
                    <option value="5">5 minutes</option>
                </select>
            </div>
            <div class="level-buttons">
                <button class="btn" onclick="startGame(1)">Niveau 1</button>
                <button class="btn" onclick="startGame(2)">Niveau 2</button>
                <button class="btn" onclick="startGame(3)">Niveau 3</button>
            </div>
            <div id="scoreBoard">
                <h3>Tableau des scores</h3>
                <div id="scores"></div>
            </div>
        </div>

        <div id="gameMenu" class="menu">
            <div class="score-display">Score: <span id="score">0</span></div>
            <div id="timerDisplay" class="hidden">Temps restant: <span id="timeLeft">0</span></div>
            <div id="question" class="question"></div>
            <button class="btn btn-micro" id="microBtn" onclick="startRecording()">üé§</button>
            <input type="text" id="answerInput" class="answer-input" placeholder="Votre r√©ponse">
            <div id="message" class="message hidden"></div>
            <div id="buttons">
                <button class="btn" onclick="checkAnswer()">V√©rifier</button>
                <button class="btn" onclick="showAnswer()">Voir la r√©ponse</button>
                <button class="btn" onclick="showConjTable()">Tableau de conjugaison</button>
                <button class="btn" onclick="backToMenu()">Menu principal</button>
            </div>
            <div id="conjTable" class="hidden"></div>
        </div>
    </div>

    <script>
        // Base de donn√©es de verbes
        const verbs = [
            // 3000 verbes les plus courants
            "avoir", "√™tre", "faire", "dire", "aller", "voir", "savoir", "vouloir", "pouvoir", "falloir",
            "devoir", "prendre", "donner", "parler", "aimer", "mettre", "venir", "passer", "trouver", "donner",
            "entrer", "sortir", "venir", "partir", "rester", "tomber", "arriver", "monter", "descendre", "rentrer",
            // Ajoutez ici les 3000 verbes restants...
        ];

        // Temps de conjugaison
        const tenses = {
            1: ["pr√©sent", "futur", "imparfait"],
            2: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent"],
            3: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent", 
                "subjonctif pass√©", "conditionnel pr√©sent", "conditionnel pass√©", "imp√©ratif pr√©sent",
                "infinitif pr√©sent", "participe pr√©sent", "participe pass√©", "futur ant√©rieur", 
                "pass√© compos√©", "pass√© ant√©rieur", "subjonctif imparfait", "subjonctif plus-que-parfait",
                "conditionnel pass√© II", "imp√©ratif pass√©", "infinitif pass√©"]
        };

        const pronouns = [
            { text: "je", display: "je (je)", person: "premi√®re personne du singulier" },
            { text: "tu", display: "tu (tu)", person: "deuxi√®me personne du singulier" },
            { text: "il/elle", display: "il/elle (il/elle)", person: "troisi√®me personne du singulier" },
            { text: "nous", display: "nous (nous)", person: "premi√®re personne du pluriel" },
            { text: "vous", display: "vous (vous)", person: "deuxi√®me personne du pluriel" },
            { text: "ils/elles", display: "ils/elles (ils/elles)", person: "troisi√®me personne du pluriel" }
        ];

        // Variables globales
        let currentLevel = 1;
        let currentScore = 0;
        let currentVerb = "";
        let currentTense = "";
        let currentPronoun = "";
        let correctAnswer = "";
        let recognition = null;
        let timer = null;
        let timeLeft = 0;

        // Conjugaison des verbes irr√©guliers
        const conjugations = {
            "avoir": {
                "pr√©sent": ["ai", "as", "a", "avons", "avez", "ont"],
                "imparfait": ["avais", "avais", "avait", "avions", "aviez", "avaient"],
                "futur": ["aurai", "auras", "aura", "aurons", "aurez", "auront"],
                "subjonctif pr√©sent": ["aie", "aies", "ait", "ayons", "ayez", "aient"]
            },
            "√™tre": {
                "pr√©sent": ["suis", "es", "est", "sommes", "√™tes", "sont"],
                "imparfait": ["√©tais", "√©tais", "√©tait", "√©tions", "√©tiez", "√©taient"],
                "futur": ["serai", "seras", "sera", "serons", "serez", "seront"],
                "subjonctif pr√©sent": ["sois", "sois", "soit", "soyons", "soyez", "soient"]
            }
            // Ajoutez ici les conjugaisons des autres verbes...
        };

        // Initialisation
        window.onload = function() {
            loadScores();
            initializeSpeechRecognition();
        };

        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'fr-FR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase().trim();
                    document.getElementById('answerInput').value = transcript;
                    checkAnswer();
                };

                recognition.onerror = function(event) {
                    speak("Erreur de reconnaissance vocale. Veuillez r√©essayer.");
                };
            }
        }

        function startRecording() {
            if (recognition) {
                recognition.start();
                document.getElementById('microBtn').style.background = 'linear-gradient(45deg, #ff6b6b 0%, #ee5a24 100%)';
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                speechSynthesis.speak(utterance);
            }
        }

        function startGame(level) {
            currentLevel = level;
            currentScore = 0;
            document.getElementById('score').textContent = currentScore;
            document.getElementById('startMenu').classList.remove('active');
            document.getElementById('gameMenu').classList.add('active');
            
            const timerMinutes = parseInt(document.getElementById('timerSelect').value);
            if (timerMinutes > 0) {
                timeLeft = timerMinutes * 60;
                document.getElementById('timerDisplay').classList.remove('hidden');
                startTimer();
            }
            
            nextQuestion();
        }

        function startTimer() {
            timer = setInterval(function() {
                timeLeft--;
                document.getElementById('timeLeft').textContent = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function nextQuestion() {
            currentVerb = verbs[Math.floor(Math.random() * verbs.length)];
            currentTense = tenses[currentLevel][Math.floor(Math.random() * tenses[currentLevel].length)];
            currentPronoun = pronouns[Math.floor(Math.random() * pronouns.length)];
            
            correctAnswer = conjugate(currentVerb, currentTense, currentPronoun.text);
            
            const questionText = `Conjugue le verbe <span class="verb">${currentVerb}</span> <span class="tense">au ${currentTense}</span> √† la <span class="pronoun">${currentPronoun.person}</span> ${currentPronoun.display}`;
            document.getElementById('question').innerHTML = questionText;
            speak(`Conjugue le verbe ${currentVerb} au ${currentTense} √† la ${currentPronoun.person}`);
            
            document.getElementById('answerInput').value = '';
            document.getElementById('message').classList.add('hidden');
            document.getElementById('conjTable').classList.add('hidden');
        }

        function conjugate(verb, tense, pronoun) {
            if (conjugations[verb] && conjugations[verb][tense]) {
                const index = pronouns.find(p => p.text === pronoun).display.includes('ils/elles') ? 5 :
                             pronouns.find(p => p.text === pronoun).display.includes('vous') ? 4 :
                             pronouns.find(p => p.text === pronoun).display.includes('nous') ? 3 :
                             pronouns.find(p => p.text === pronoun).display.includes('il/elle') ? 2 :
                             pronouns.find(p => p.text === pronoun).display.includes('tu') ? 1 : 0;
                return conjugations[verb][tense][index];
            }
            
            // Conjugaison automatique pour les verbes r√©guliers
            if (verb.endsWith('er')) {
                return conjugateER(verb, tense, pronoun);
            } else if (verb.endsWith('ir')) {
                return conjugateIR(verb, tense, pronoun);
            } else if (verb.endsWith('re')) {
                return conjugateRE(verb, tense, pronoun);
            }
            
            return verb; // Par d√©faut
        }

        function conjugateER(verb, tense, pronoun) {
            const stem = verb.slice(0, -2);
            const endings = {
                "pr√©sent": ["e", "es", "e", "ons", "ez", "ent"],
                "imparfait": ["ais", "ais", "ait", "ions", "iez", "aient"],
                "futur": ["erai", "eras", "era", "erons", "erez", "eront"],
                "subjonctif pr√©sent": ["e", "es", "e", "ions", "iez", "ent"]
            };
            
            if (endings[tense]) {
                const index = pronouns.findIndex(p => p.text === pronoun);
                return stem + endings[tense][index];
            }
            return verb;
        }

        function conjugateIR(verb, tense, pronoun) {
            const stem = verb.slice(0, -2);
            const endings = {
                "pr√©sent": ["is", "is", "it", "issons", "issez", "issent"],
                "imparfait": ["issais", "issais", "issait", "issions", "issiez", "issaient"],
                "futur": ["irai", "iras", "ira", "irons", "irez", "iront"],
                "subjonctif pr√©sent": ["isse", "isses", "isse", "issions", "issiez", "issent"]
            };
            
            if (endings[tense]) {
                const index = pronouns.findIndex(p => p.text === pronoun);
                return stem + endings[tense][index];
            }
            return verb;
        }

        function conjugateRE(verb, tense, pronoun) {
            const stem = verb.slice(0, -2);
            const endings = {
                "pr√©sent": ["s", "s", "", "ons", "ez", "ent"],
                "imparfait": ["ais", "ais", "ait", "ions", "iez", "aient"],
                "futur": ["rai", "ras", "ra", "rons", "rez", "ront"],
                "subjonctif pr√©sent": ["e", "es", "e", "ions", "iez", "ent"]
            };
            
            if (endings[tense]) {
                const index = pronouns.findIndex(p => p.text === pronoun);
                return stem + endings[tense][index];
            }
            return verb;
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.toLowerCase().trim();
            const messageEl = document.getElementById('message');
            
            // Gestion des apostrophes et liaisons
            const processedAnswer = userAnswer.replace(/^\s*je\s+([aeiouy])/i, "j'$1");
            const processedCorrect = correctAnswer.replace(/^\s*je\s+([aeiouy])/i, "j'$1");
            
            if (processedAnswer === processedCorrect || 
                processedAnswer === correctAnswer || 
                userAnswer === correctAnswer) {
                currentScore += 5;
                document.getElementById('score').textContent = currentScore;
                messageEl.textContent = "Bravo! C'est super! Formidable!";
                messageEl.className = "message success";
                speak("Bravo! C'est super!");
                setTimeout(nextQuestion, 2000);
            } else {
                currentScore -= 5;
                document.getElementById('score').textContent = currentScore;
                speak("Erreur!");
                messageEl.textContent = "Erreur! Tu peux le faire! Allez, continue! R√©fl√©chis!";
                messageEl.className = "message error";
                document.getElementById('answerInput').value = '';
            }
        }

        function showAnswer() {
            speak(`La r√©ponse est: ${correctAnswer}`);
            document.getElementById('answerInput').value = correctAnswer;
        }

        function showConjTable() {
            const tableHtml = generateConjugationTable(currentVerb);
            document.getElementById('conjTable').innerHTML = tableHtml;
            document.getElementById('conjTable').classList.remove('hidden');
        }

        function generateConjugationTable(verb) {
            let html = `<h3>Conjugaison de ${verb}</h3><table>`;
            html += "<tr><th>Temps</th><th>je</th><th>tu</th><th>il/elle</th><th>nous</th><th>vous</th><th>ils/elles</th></tr>";
            
            tenses[currentLevel].forEach(tense => {
                html += `<tr><td>${tense}</td>`;
                pronouns.forEach(pronoun => {
                    const conj = conjugate(verb, tense, pronoun.text);
                    html += `<td>${conj}</td>`;
                });
                html += "</tr>";
            });
            
            html += "</table>";
            return html;
        }

        function saveName() {
            const name = document.getElementById('playerName').value;
            if (name) {
                localStorage.setItem('playerName', name);
                alert(`Nom enregistr√©: ${name}`);
            }
        }

        function loadScores() {
            const scores = JSON.parse(localStorage.getItem('scores') || '[]');
            const scoresHtml = scores.sort((a, b) => b.score - a.score)
                .slice(0, 10)
                .map((s, i) => `<div>${i + 1}. ${s.name}: ${s.score} points</div>`)
                .join('');
            document.getElementById('scores').innerHTML = scoresHtml || "Aucun score enregistr√©";
        }

        function saveScore() {
            const name = localStorage.getItem('playerName') || 'Anonyme';
            const scores = JSON.parse(localStorage.getItem('scores') || '[]');
            scores.push({ name, score: currentScore, date: new Date().toISOString() });
            localStorage.setItem('scores', JSON.stringify(scores));
        }

        function endGame() {
            saveScore();
            speak(`Jeu termin√©! Votre score final est de ${currentScore} points.`);
            alert(`Jeu termin√©! Votre score final est de ${currentScore} points.`);
            backToMenu();
        }

        function backToMenu() {
            if (timer) clearInterval(timer);
            document.getElementById('gameMenu').classList.remove('active');
            document.getElementById('startMenu').classList.add('active');
            loadScores();
        }
    </script>
</body>
</html>
