<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma√Ætre de la Conjugaison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 90%;
        }

        .title {
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .menu {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
            background: linear-gradient(45deg, #3a9cfc 0%, #00d4e0 100%);
        }

        .btn.micro {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 1.5em;
        }

        .btn.micro.listening {
            background: linear-gradient(45deg, #ff6b6b 0%, #ff8787 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .question {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.3em;
            line-height: 1.6;
        }

        .verb { color: #e74c3c; font-weight: bold; }
        .tense { color: #3498db; font-weight: bold; }
        .pronoun { color: #27ae60; font-weight: bold; }

        .answer-section {
            text-align: center;
            margin: 20px 0;
        }

        .answer-input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            width: 300px;
            margin: 10px;
            transition: border-color 0.3s;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .score {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
            color: #2c3e50;
        }

        .message {
            text-align: center;
            font-size: 1.3em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2c3e50;
        }

        .error {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #c0392b;
        }

        .conjugation-table {
            display: none;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .conjugation-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .conjugation-table th,
        .conjugation-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .conjugation-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .timer {
            text-align: center;
            font-size: 1.2em;
            color: #e74c3c;
            margin: 10px 0;
        }

        .player-name {
            text-align: center;
            margin: 20px 0;
        }

        .player-name input {
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin: 0 10px;
        }

        .leaderboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .leaderboard h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .hidden {
            display: none;
        }

        .difficulty-selector {
            text-align: center;
            margin: 20px 0;
        }

        .difficulty-btn {
            background: linear-gradient(45deg, #ff6b6b 0%, #ffa500 100%);
            margin: 5px;
        }

        .timer-selector {
            text-align: center;
            margin: 20px 0;
        }

        .timer-btn {
            background: linear-gradient(45deg, #56ab2f 0%, #a8e6cf 100%);
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Ma√Ætre de la Conjugaison</h1>
        
        <div id="menu" class="menu">
            <div class="player-name">
                <label for="playerName">Entrez votre nom : </label>
                <input type="text" id="playerName" placeholder="Votre nom">
            </div>
            <button class="btn" onclick="showDifficulty()">Commencer</button>
            <button class="btn" onclick="showLeaderboard()">Tableau des scores</button>
        </div>

        <div id="difficulty" class="hidden">
            <h3 style="text-align: center; margin-bottom: 20px;">Choisissez votre niveau</h3>
            <div class="difficulty-selector">
                <button class="btn difficulty-btn" onclick="startGame(1)">Niveau 1<br>(Pr√©sent, Futur, Imparfait)</button>
                <button class="btn difficulty-btn" onclick="startGame(2)">Niveau 2<br>(+ Pass√© simple, Plus-que-parfait, Subjonctif)</button>
                <button class="btn difficulty-btn" onclick="startGame(3)">Niveau 3<br>(21 temps)</button>
            </div>
            <h3 style="text-align: center; margin: 20px 0;">Choisissez la dur√©e</h3>
            <div class="timer-selector">
                <button class="btn timer-btn" onclick="setTimer(15)">15 minutes</button>
                <button class="btn timer-btn" onclick="setTimer(10)">10 minutes</button>
                <button class="btn timer-btn" onclick="setTimer(5)">5 minutes</button>
                <button class="btn timer-btn" onclick="setTimer(0)">Sans limite</button>
            </div>
        </div>

        <div id="game" class="hidden">
            <div class="timer" id="timer"></div>
            <div class="score">Score : <span id="scoreValue">0</span></div>
            
            <div id="question" class="question"></div>
            
            <div class="answer-section">
                <input type="text" id="answerInput" class="answer-input" placeholder="Votre r√©ponse">
                <button class="btn micro" id="microBtn" onclick="startRecognition()">üé§</button>
            </div>
            
            <div id="message" class="message hidden"></div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="showAnswer()">Montrer la r√©ponse</button>
                <button class="btn" onclick="showConjugation()">Tableau de conjugaison</button>
                <button class="btn" onclick="backToMenu()">Menu principal</button>
            </div>
            
            <div id="conjugationTable" class="conjugation-table"></div>
        </div>

        <div id="leaderboard" class="leaderboard hidden">
            <h3>Tableau des scores</h3>
            <div id="leaderboardContent"></div>
            <button class="btn" onclick="backToMenu()">Retour</button>
        </div>
    </div>

    <script>
        // Base de donn√©es de verbes
        const verbs = [
            "avoir", "√™tre", "faire", "aller", "prendre", "venir", "voir", "savoir", "vouloir", "pouvoir",
            "devoir", "falloir", "dire", "mettre", "donner", "parler", "trouver", "passer", "laisser", "penser",
            "croire", "connaitre", "comprendre", "rester", "tenir", "mener", "porter", "partir", "servir", "vivre",
            "suivre", "recevoir", "appeler", "lire", "√©crire", "devenir", "tomber", "naitre", "mourir", "entendre",
            "sentir", "attendre", "chercher", "regarder", "aimer", "adorer", "d√©tester", "pr√©f√©rer", "esp√©rer", "essayer",
            "oublier", "rappeler", "apprendre", "enseigner", "√©tudier", "travailler", "jouer", "danser", "chanter", "rire",
            "pleurer", "sourire", "grandir", "maigrir", "grossir", "vieillir", "jeunir", "m√ªrir", "rougir", "p√¢lir",
            "fatiguer", "reposer", "dormir", "r√©veiller", "lever", "coucher", "habiller", "d√©shabiller", "peigner", "laver",
            "nettoyer", "salir", "organiser", "d√©sorganiser", "pr√©parer", "d√©truire", "construire", "fabriquer", "r√©parer", "casser",
            "ouvrir", "fermer", "commencer", "finir", "continuer", "arr√™ter", "recommencer", "terminer", "gagner", "perdre",
            "acheter", "vendre", "payer", "recevoir", "d√©penser", "√©conomiser", "investir", "emprunter", "pr√™ter", "rendre",
            "emprunter", "rendre", "donner", "offrir", "recevoir", "accepter", "refuser", "choisir", "d√©cider", "h√©siter",
            "r√©fl√©chir", "m√©diter", "consid√©rer", "examiner", "analyser", "comparer", "opposer", "diff√©rencier", "ressembler", "imiter",
            "inventer", "cr√©er", "imaginer", "r√™ver", "penser", "croire", "douter", "certifier", "prouver", "d√©montrer",
            "expliquer", "comprendre", "interpr√©ter", "traduire", "d√©finir", "d√©crire", "raconter", "exprimer", "montrer", "cacher",
            "r√©v√©ler", "d√©couvrir", "trouver", "perdre", "chercher", "explorer", "visiter", "voyager", "d√©placer", "bouger",
            "courir", "marcher", "sauter", "nager", "voler", "tomber", "se lever", "s'asseoir", "se coucher", "se r√©veiller"
        ];

        // Ajouter plus de verbes jusqu'√† 3000
        const additionalVerbs = [];
        const verbFamilies = ["er", "ir", "re", "oir"];
        const prefixes = ["re", "d√©", "sur", "sous", "contre", "entre", "pr√©", "post", "anti", "pro"];
        
        for (let i = 0; i < 2900; i++) {
            const family = verbFamilies[Math.floor(Math.random() * verbFamilies.length)];
            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const root = String.fromCharCode(97 + Math.floor(Math.random() * 26)) + 
                        String.fromCharCode(97 + Math.floor(Math.random() * 26)) + 
                        String.fromCharCode(97 + Math.floor(Math.random() * 26));
            additionalVerbs.push(prefix + root + family);
        }
        
        const allVerbs = [...verbs, ...additionalVerbs];

        // Temps de conjugaison
        const tenses = {
            1: ["pr√©sent", "futur", "imparfait"],
            2: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent"],
            3: ["pr√©sent", "futur", "imparfait", "pass√© simple", "plus-que-parfait", "subjonctif pr√©sent", 
                "subjonctif pass√©", "conditionnel pr√©sent", "conditionnel pass√©", "imp√©ratif", 
                "participe pr√©sent", "participe pass√©", "infinitif", "futur ant√©rieur", 
                "pass√© compos√©", "pass√© ant√©rieur", "subjonctif imparfait", "subjonctif plus-que-parfait",
                "conditionnel pass√© II", "imp√©ratif pass√©", "infinitif pass√©"]
        };

        // Pronoms
        const pronouns = [
            { text: "je", person: "1e personne du singulier", alias: ["j'"] },
            { text: "tu", person: "2e personne du singulier", alias: [] },
            { text: "il", person: "3e personne du singulier", alias: [] },
            { text: "elle", person: "3e personne du singulier", alias: [] },
            { text: "nous", person: "1re personne du pluriel", alias: [] },
            { text: "vous", person: "2e personne du pluriel", alias: [] },
            { text: "ils", person: "3e personne du pluriel", alias: [] },
            { text: "elles", person: "3e personne du pluriel", alias: [] }
        ];

        // Variables globales
        let currentScore = 0;
        let currentVerb = "";
        let currentTense = "";
        let currentPronoun = "";
        let currentAnswer = "";
        let currentLevel = 1;
        let timerDuration = 0;
        let timerInterval = null;
        let recognition = null;

        // Conjugaison des verbes irr√©guliers
        const irregularConjugations = {
            "avoir": {
                "pr√©sent": ["ai", "as", "a", "a", "avons", "avez", "ont", "ont"],
                "imparfait": ["avais", "avais", "avait", "avait", "avions", "aviez", "avaient", "avaient"],
                "futur": ["aurai", "auras", "aura", "aura", "aurons", "aurez", "auront", "auront"],
                "pass√© simple": ["eus", "eus", "eut", "eut", "e√ªmes", "e√ªtes", "eurent", "eurent"],
                "plus-que-parfait": ["avais eu", "avais eu", "avait eu", "avait eu", "avions eu", "aviez eu", "avaient eu", "avaient eu"],
                "subjonctif pr√©sent": ["aie", "aies", "ait", "ait", "ayons", "ayez", "aient", "aient"]
            },
            "√™tre": {
                "pr√©sent": ["suis", "es", "est", "est", "sommes", "√™tes", "sont", "sont"],
                "imparfait": ["√©tais", "√©tais", "√©tait", "√©tait", "√©tions", "√©tiez", "√©taient", "√©taient"],
                "futur": ["serai", "seras", "sera", "sera", "serons", "serez", "seront", "seront"],
                "pass√© simple": ["fus", "fus", "fut", "fut", "f√ªmes", "f√ªtes", "furent", "furent"],
                "plus-que-parfait": ["avais √©t√©", "avais √©t√©", "avait √©t√©", "avait √©t√©", "avions √©t√©", "aviez √©t√©", "avaient √©t√©", "avaient √©t√©"],
                "subjonctif pr√©sent": ["sois", "sois", "soit", "soit", "soyons", "soyez", "soient", "soient"]
            },
            "faire": {
                "pr√©sent": ["fais", "fais", "fait", "fait", "faisons", "faites", "font", "font"],
                "imparfait": ["faisais", "faisais", "faisait", "faisait", "faisions", "faisiez", "faisaient", "faisaient"],
                "futur": ["ferai", "feras", "fera", "fera", "ferons", "ferez", "feront", "feront"],
                "pass√© simple": ["fis", "fis", "fit", "fit", "f√Æmes", "f√Ætes", "firent", "firent"],
                "plus-que-parfait": ["avais fait", "avais fait", "avait fait", "avait fait", "avions fait", "aviez fait", "avaient fait", "avaient fait"],
                "subjonctif pr√©sent": ["fasse", "fasses", "fasse", "fasse", "fassions", "fassiez", "fassent", "fassent"]
            },
            "aller": {
                "pr√©sent": ["vais", "vas", "va", "va", "allons", "allez", "vont", "vont"],
                "imparfait": ["allais", "allais", "allait", "allait", "allions", "alliez", "allaient", "allaient"],
                "futur": ["irai", "iras", "ira", "ira", "irons", "irez", "iront", "iront"],
                "pass√© simple": ["allai", "allas", "alla", "alla", "all√¢mes", "all√¢tes", "all√®rent", "all√®rent"],
                "plus-que-parfait": ["√©tais all√©", "√©tais all√©", "√©tait all√©", "√©tait all√©e", "√©tions all√©s", "√©tiez all√©s", "√©taient all√©s", "√©taient all√©es"],
                "subjonctif pr√©sent": ["aille", "ailles", "aille", "aille", "allions", "alliez", "aillent", "aillent"]
            }
        };

        // Fonction de conjugaison automatique
        function conjugate(verb, tense, pronounIndex) {
            // V√©rifier si le verbe est irr√©gulier
            if (irregularConjugations[verb] && irregularConjugations[verb][tense]) {
                return irregularConjugations[verb][tense][pronounIndex];
            }

            // Conjugaison r√©guli√®re simplifi√©e
            const endings = {
                "pr√©sent": {
                    "er": ["e", "es", "e", "e", "ons", "ez", "ent", "ent"],
                    "ir": ["is", "is", "it", "it", "issons", "issez", "issent", "issent"],
                    "re": ["s", "s", "", "", "ons", "ez", "ent", "ent"],
                    "oir": ["s", "s", "t", "t", "ons", "ez", "ent", "ent"]
                },
                "imparfait": {
                    "er": ["ais", "ais", "ait", "ait", "ions", "iez", "aient", "aient"],
                    "ir": ["issais", "issais", "issait", "issait", "issions", "issiez", "issaient", "issaient"],
                    "re": ["ais", "ais", "ait", "ait", "ions", "iez", "aient", "aient"],
                    "oir": ["ais", "ais", "ait", "ait", "ions", "iez", "aient", "aient"]
                },
                "futur": {
                    "er": ["erai", "eras", "era", "era", "erons", "erez", "eront", "eront"],
                    "ir": ["irai", "iras", "ira", "ira", "irons", "irez", "iront", "iront"],
                    "re": ["rai", "ras", "ra", "ra", "rons", "rez", "ront", "ront"],
                    "oir": ["ai", "as", "a", "a", "ons", "ez", "ont", "ont"]
                }
            };

            const family = verb.endsWith("er") ? "er" : verb.endsWith("ir") ? "ir" : verb.endsWith("re") ? "re" : "oir";
            const stem = verb.substring(0, verb.length - family.length);
            
            if (endings[tense] && endings[tense][family]) {
                return stem + endings[tense][family][pronounIndex];
            }

            // Retour par d√©faut
            return verb;
        }

        // Fonction pour obtenir la r√©ponse correcte
        function getCorrectAnswer(verb, tense, pronounIndex) {
            const answer = conjugate(verb, tense, pronounIndex);
            const pronoun = pronouns[pronounIndex].text;
            
            // G√©rer l'√©lision
            if (pronoun === "je" && "aeiouy".includes(answer[0].toLowerCase())) {
                return "j'" + answer;
            }
            
            return pronoun + " " + answer;
        }

        // Fonction pour afficher le menu de difficult√©
        function showDifficulty() {
            const playerName = document.getElementById('playerName').value;
            if (!playerName) {
                alert('Veuillez entrer votre nom');
                return;
            }
            
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('difficulty').classList.remove('hidden');
        }

        // Fonction pour d√©finir la minuterie
        function setTimer(minutes) {
            timerDuration = minutes * 60;
        }

        // Fonction pour d√©marrer le jeu
        function startGame(level) {
            currentLevel = level;
            currentScore = 0;
            document.getElementById('scoreValue').textContent = currentScore;
            
            document.getElementById('difficulty').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            
            if (timerDuration > 0) {
                startTimer();
            }
            
            generateQuestion();
            initializeSpeechRecognition();
        }

        // Fonction pour d√©marrer la minuterie
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timerDuration--;
                const minutes = Math.floor(timerDuration / 60);
                const seconds = timerDuration % 60;
                document.getElementById('timer').textContent = 
                    `Temps restant : ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timerDuration <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        // Fonction pour g√©n√©rer une question
        function generateQuestion() {
            currentVerb = allVerbs[Math.floor(Math.random() * allVerbs.length)];
            currentTense = tenses[currentLevel][Math.floor(Math.random() * tenses[currentLevel].length)];
            currentPronoun = Math.floor(Math.random() * pronouns.length);
            
            const pronounText = pronouns[currentPronoun].person;
            const pronounExamples = `(${pronouns[currentPronoun].text}${pronouns[currentPronoun].text === 'il' ? '/elle' : pronouns[currentPronoun].text === 'ils' ? '/elles' : ''})`;
            
            const questionText = `Conjugue le verbe <span class="verb">${currentVerb}</span> √† <span class="tense">${currentTense}</span> √† la <span class="pronoun">${pronounText} ${pronounExamples}</span>`;
            document.getElementById('question').innerHTML = questionText;
            
            currentAnswer = getCorrectAnswer(currentVerb, currentTense, currentPronoun);
            
            // √ânoncer la question
            speak(`Conjugue le verbe ${currentVerb} √† ${currentTense} √† la ${pronounText}`);
            
            // Cacher les tableaux et messages
            document.getElementById('conjugationTable').style.display = 'none';
            document.getElementById('message').classList.add('hidden');
            document.getElementById('answerInput').value = '';
        }

        // Fonction pour v√©rifier la r√©ponse
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
            const correctAnswer = currentAnswer.toLowerCase();
            
            // V√©rification tol√©rante
            const isCorrect = userAnswer === correctAnswer || 
                             (userAnswer.replace(/'/g, "") === correctAnswer.replace(/'/g, "")) ||
                             (userAnswer.replace(/ /g, "") === correctAnswer.replace(/ /g, ""));
            
            const messageDiv = document.getElementById('message');
            
            if (isCorrect) {
                currentScore += 5;
                const encouragements = ["Bravo !", "C'est super !", "Formidable !", "C'est g√©nial !"];
                const message = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                messageDiv.textContent = message;
                messageDiv.className = 'message success';
                messageDiv.classList.remove('hidden');
                
                speak(message);
                
                document.getElementById('scoreValue').textContent = currentScore;
                
                setTimeout(() => {
                    generateQuestion();
                }, 2000);
            } else {
                currentScore -= 5;
                
                speak("Erreur");
                
                const encouragements = ["Tu peux le faire !", "Allez, continue !", "R√©fl√©chis bien !"];
                const message = "Erreur. " + encouragements[Math.floor(Math.random() * encouragements.length)];
                
                messageDiv.textContent = message;
                messageDiv.className = 'message error';
                messageDiv.classList.remove('hidden');
                
                document.getElementById('scoreValue').textContent = currentScore;
                document.getElementById('answerInput').value = '';
                
                speak(message);
            }
        }

        // Fonction pour montrer la r√©ponse
        function showAnswer() {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = `La r√©ponse est : ${currentAnswer}`;
            messageDiv.className = 'message success';
            messageDiv.classList.remove('hidden');
            
            speak(`La r√©ponse est : ${currentAnswer}`);
        }

        // Fonction pour afficher le tableau de conjugaison
        function showConjugation() {
            const tableDiv = document.getElementById('conjugationTable');
            tableDiv.style.display = 'block';
            
            let html = '<h3>Conjugaison compl√®te</h3>';
            html += '<table>';
            html += '<tr><th>Temps</th><th>Je</th><th>Tu</th><th>Il/Elle</th><th>Nous</th><th>Vous</th><th>Ils/Elles</th></tr>';
            
            const tensesToShow = tenses[currentLevel];
            tensesToShow.forEach(tense => {
                html += `<tr><td>${tense}</td>`;
                for (let i = 0; i < 6; i++) {
                    const answer = getCorrectAnswer(currentVerb, tense, i);
                    html += `<td>${answer}</td>`;
                }
                html += '</tr>';
            });
            
            html += '</table>';
            tableDiv.innerHTML = html;
        }

        // Fonction pour retourner au menu
        function backToMenu() {
            if (timerInterval) clearInterval(timerInterval);
            
            document.getElementById('game').classList.add('hidden');
            document.getElementById('difficulty').classList.add('hidden');
            document.getElementById('leaderboard').classList.add('hidden');
            document.getElementById('menu').classList.remove('hidden');
            
            // Sauvegarder le score
            saveScore();
        }

        // Fonction pour sauvegarder le score
        function saveScore() {
            const playerName = document.getElementById('playerName').value;
            if (!playerName) return;
            
            let scores = JSON.parse(localStorage.getItem('conjugationScores') || '[]');
            scores.push({
                name: playerName,
                score: currentScore,
                date: new Date().toLocaleDateString()
            });
            
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 10); // Garder les 10 meilleurs
            
            localStorage.setItem('conjugationScores', JSON.stringify(scores));
        }

        // Fonction pour afficher le tableau des scores
        function showLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('conjugationScores') || '[]');
            const content = document.getElementById('leaderboardContent');
            
            if (scores.length === 0) {
                content.innerHTML = '<p>Aucun score enregistr√©</p>';
            } else {
                let html = '';
                scores.forEach((score, index) => {
                    html += `<div class="leaderboard-entry">
                        <span>${index + 1}. ${score.name}</span>
                        <span>${score.score} points</span>
                    </div>`;
                });
                content.innerHTML = html;
            }
            
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('leaderboard').classList.remove('hidden');
        }

        // Fonction pour finir le jeu
        function endGame() {
            saveScore();
            alert(`Jeu termin√© ! Votre score final est : ${currentScore} points`);
            backToMenu();
        }

        // Fonction pour parler
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                speechSynthesis.speak(utterance);
            }
        }

        // Fonction pour initialiser la reconnaissance vocale
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.lang = 'fr-FR';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.trim();
                    document.getElementById('answerInput').value = transcript;
                    checkAnswer();
                };
                
                recognition.onerror = function(event) {
                    console.log('Erreur de reconnaissance vocale :', event.error);
                    document.getElementById('microBtn').classList.remove('listening');
                };
                
                recognition.onend = function() {
                    document.getElementById('microBtn').classList.remove('listening');
                };
            }
        }

        // Fonction pour d√©marrer la reconnaissance vocale
        function startRecognition() {
            if (recognition) {
                document.getElementById('microBtn').classList.add('listening');
                recognition.start();
            } else {
                alert('La reconnaissance vocale n\'est pas support√©e par votre navigateur');
            }
        }

        // √âcouter la touche Entr√©e
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        });
    </script>
</body>
</html>
